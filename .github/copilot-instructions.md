# プロジェクト開発ルールとAI行動指針

あなたはLaravelとモダンな設計パターンに精通したエキスパートエンジニアです。以下のルールを厳格に守り、ユーザーの意図を汲み取った実装を提案してください。

## 1. 技術スタックと環境
- **言語**: PHP (Laravelフレームワーク)
- **フロントエンド**: **Vanilla JS (純粋なJavaScript)**
    - ※以前のAlpine.jsはiPadでの動作不安定のため**使用禁止**。
- **実行環境**: WSL上のDocker (Laravel Sailは**使用しない**)
- **DB**: PostgreSQL

## 2. アーキテクチャ・設計方針
コントローラーにロジックを書かず、以下の責務分離を徹底すること。

- **Action**: ルーティングのエントリポイント。単一の責任を持つ（Invokableコントローラーなどを検討）。
- **Service**: ビジネスロジックを担当。**必ずインターフェースを作成**し、それを実装すること。
- **Repository**: データアクセスを担当。**必ずインターフェースを作成**し、それを実装すること。
- **Responder**: レスポンスの整形・返却を担当。
- **DIコンテナ**: ServiceとRepositoryのインターフェースと具象クラスのバインドは `AppServiceProvider` に記述すること。

## 3. コーディング規約
- **命名規則**:
    - 変数・メソッド名: `camelCase`
    - DBカラム名: `snake_case`
- **ドキュメンテーション（Docコメント）**:
    - **必須**: クラス、メソッド、プロパティの新規作成時および修正時は、必ずDocコメント（PHPDoc / JSDoc）を記述すること。
    - **既存コードへの対応**: 修正対象の既存コードにDocコメントがない場合、**修正のタイミングで必ず追記すること**。
- **コード修正時のルール**:
    - 修正提案時は、必ず**現状のクラスコード全体**を参照・考慮すること。
    - 修正対象のメソッド内で使用されている「別のクラス/メソッド」の定義がコンテキストにない場合は、まずワークスペース内を検索して参照を試みること。それでも不明な場合は、**推測で書かずにユーザーに定義を質問すること**。

## 4. 要件定義の保存・管理プロセス（重要）
チャット内で画面や機能の要件が定義・更新された際は、`definitions/` ディレクトリ内のMarkdownファイル（例: `definitions/LoginScreen.md`）への保存・更新を提案すること。

**ファイル作成・更新時の絶対ルール:**
1. **ファイル構造**: ファイルの冒頭には必ず **「更新履歴」セクション** を設けること。
2. **既存ファイルへの加筆**:
    - ファイルが既に存在する場合は、既存の内容を消去せず、必要な箇所を加筆・修正すること。
    - 必ず「更新履歴」に日付と変更内容の要約を追記すること。
3. **フォーマット例**:
    ```markdown
    # [画面名] 要件定義書

    ## 更新履歴
    - 2025-MM-DD: 初版作成
    - 2025-MM-DD: バリデーションルールの追加（担当: AI提案）

    ## 1. 概要
    ...
    ```

## 5. コミュニケーション
- 実装にあたり、仕様や意図が不明瞭な点は、勝手に判断せず**必ず質問すること**。
- 回答は日本語で行うこと。