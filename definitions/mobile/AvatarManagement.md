# ã‚¢ãƒã‚¿ãƒ¼ç®¡ç†æ©Ÿèƒ½ è¦ä»¶å®šç¾©æ›¸ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç‰ˆï¼‰

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | æ›´æ–°è€… | æ›´æ–°å†…å®¹ |
|------|--------|---------|
| 2025-12-08 | GitHub Copilot | åˆç‰ˆä½œæˆ: Phase 2.B-7å®Ÿè£…ã«å‘ã‘ãŸãƒ¢ãƒã‚¤ãƒ«ç‰ˆè¦ä»¶å®šç¾© |

---

## 1. æ¦‚è¦

MyTeacher ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã«ãŠã‘ã‚‹æ•™å¸«ã‚¢ãƒã‚¿ãƒ¼ç®¡ç†æ©Ÿèƒ½ã®è¦ä»¶å®šç¾©æ›¸ã§ã™ã€‚AIç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒã‚¿ãƒ¼ç”»åƒã®ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### Webç‰ˆã¨ã®å·®ç•°

| é …ç›® | Webç‰ˆ | ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ |
|------|-------|-----------|
| åˆå›ç”Ÿæˆãƒ•ãƒ­ãƒ¼ | ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è‡ªå‹•è¡¨ç¤º | è¨­å®šç”»é¢ã‹ã‚‰ä»»æ„ä½œæˆ |
| å­ã©ã‚‚å‘ã‘UI | ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰å½¢å¼ï¼ˆ5ã‚¹ãƒ†ãƒƒãƒ—ï¼‰ | çµ±ä¸€UIï¼ˆå…¨ãƒ†ãƒ¼ãƒå…±é€šï¼‰ |
| ç”»åƒç”Ÿæˆå¾…æ©Ÿ | ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸é·ç§» | ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ç”Ÿæˆ + é€šçŸ¥ |
| ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤º | ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ã«ç”»é¢å³ä¸‹è¡¨ç¤º | âœ… Phase 2.B-5 Step 3ã§å®Ÿè£…æ¸ˆã¿ |

**Phase 2.B-5 Step 3å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½**:
- ã‚¢ãƒã‚¿ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºæ©Ÿèƒ½ï¼ˆAvatarContext.tsxï¼‰
- 5ã¤ã®ã‚¢ãƒã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã€ã‚¿ã‚¹ã‚¯ä½œæˆã€ã‚¿ã‚¹ã‚¯å®Œäº†ã€ã‚¿ã‚¹ã‚¯æ›´æ–°ã€ã‚¿ã‚¹ã‚¯å‰Šé™¤ï¼‰
- 20ç§’è‡ªå‹•éè¡¨ç¤ºã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

**Phase 2.B-7å®Ÿè£…å¯¾è±¡**:
- ã‚¢ãƒã‚¿ãƒ¼ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ç”»é¢
- ã‚¢ãƒã‚¿ãƒ¼ç®¡ç†æ©Ÿèƒ½ï¼ˆCRUDï¼‰

---

## 2. æ©Ÿèƒ½è¦ä»¶

### 2.1 ã‚¢ãƒã‚¿ãƒ¼ä½œæˆæ©Ÿèƒ½

#### 2.1.1 ä½œæˆãƒ•ãƒ­ãƒ¼

```
ãƒ›ãƒ¼ãƒ ç”»é¢ or è¨­å®šç”»é¢
    â†“
ã€Œã‚¢ãƒã‚¿ãƒ¼ä½œæˆã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    â†“
AvatarCreateScreenè¡¨ç¤º
    â†“
å¤–è¦‹ãƒ»æ€§æ ¼é¸æŠï¼ˆçµ±ä¸€UIï¼‰
    â†“
ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    â†“
APIå‘¼ã³å‡ºã—ï¼ˆPOST /api/avatarï¼‰
    â†“
ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç”»åƒç”Ÿæˆé–‹å§‹
    â†“
å³åº§ã«å‰ç”»é¢ã¸æˆ»ã‚‹
    â†“
ç”Ÿæˆå®Œäº†æ™‚ã«é€šçŸ¥
```

#### 2.1.2 å…¥åŠ›é …ç›®

**å¤–è¦‹è¨­å®šï¼ˆ6é …ç›®ï¼‰**:
- æ€§åˆ¥ï¼ˆsexï¼‰: ç”·æ€§/å¥³æ€§/ä¸­æ€§
- é«ªå‹ï¼ˆhair_styleï¼‰: ã‚·ãƒ§ãƒ¼ãƒˆ/ãƒŸãƒ‡ã‚£ã‚¢ãƒ /ãƒ­ãƒ³ã‚°/ãƒ„ãƒ¼ã‚µã‚¤ãƒ‰
- é«ªã®è‰²ï¼ˆhair_colorï¼‰: é»’/èŒ¶/é‡‘/èµ¤/é’/ç·‘/ç´«/ãƒ”ãƒ³ã‚¯/ç™½
- ç›®ã®è‰²ï¼ˆeye_colorï¼‰: é»’/èŒ¶/é’/ç·‘/ãƒ˜ãƒ¼ã‚¼ãƒ«/ã‚°ãƒ¬ãƒ¼
- æœè£…ï¼ˆclothingï¼‰: ã‚¹ãƒ¼ãƒ„/ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«/æ•™å¸«æœ/å­¦è€…é¢¨
- ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ï¼ˆaccessoryï¼‰: ãªã—/ãƒ¡ã‚¬ãƒ/ãƒã‚¯ã‚¿ã‚¤/ãƒ”ã‚¢ã‚¹

**æ€§æ ¼è¨­å®šï¼ˆ4é …ç›®ï¼‰**:
- å£èª¿ï¼ˆtoneï¼‰: å„ªã—ã„/å³ã—ã„/ãƒ•ãƒ©ãƒ³ã‚¯/ä¸å¯§
- ç†±æ„ï¼ˆenthusiasmï¼‰: é«˜ã„/æ™®é€š/æ§ãˆã‚
- ä¸å¯§ã•ï¼ˆformalityï¼‰: ä¸å¯§/æ™®é€š/ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«
- ãƒ¦ãƒ¼ãƒ¢ã‚¢ï¼ˆhumorï¼‰: ã‚ã‚Š/ãªã—

**è‡ªå‹•è¨­å®šé …ç›®**:
- `draw_model_version`: "flux-1.1-pro" (å›ºå®š)
- `is_transparent`: true (å›ºå®šã€èƒŒæ™¯é€é)
- `is_chibi`: false (å›ºå®šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒ¡ãªã—)

#### 2.1.3 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

- å…¨å¿…é ˆé …ç›®ã®å…¥åŠ›ãƒã‚§ãƒƒã‚¯
- APIã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒˆãƒ¼ã‚¯ãƒ³ä¸è¶³æ™‚ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

#### 2.1.4 æˆåŠŸæ™‚ã®æŒ™å‹•

1. APIå‘¼ã³å‡ºã—æˆåŠŸï¼ˆ201 Createdï¼‰
2. ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º: "ã‚¢ãƒã‚¿ãƒ¼ã®ä½œæˆã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚ç”»åƒç”Ÿæˆã«ã¯æ•°åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚"
3. å‰ç”»é¢ã¸è‡ªå‹•é·ç§»
4. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§GenerateAvatarImagesJobå®Ÿè¡Œ
5. ç”Ÿæˆå®Œäº†æ™‚ã«é€šçŸ¥é€ä¿¡ï¼ˆPhase 2.B-7.5ã®Pushé€šçŸ¥æ©Ÿèƒ½ã§å®Ÿè£…ï¼‰

### 2.2 ã‚¢ãƒã‚¿ãƒ¼ç·¨é›†æ©Ÿèƒ½

#### 2.2.1 ç·¨é›†ãƒ•ãƒ­ãƒ¼

```
è¨­å®šç”»é¢ or ãƒ›ãƒ¼ãƒ ç”»é¢
    â†“
ã€Œã‚¢ãƒã‚¿ãƒ¼è¨­å®šã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    â†“
AvatarManageScreenè¡¨ç¤º
    â†“
ç¾åœ¨ã®ã‚¢ãƒã‚¿ãƒ¼æƒ…å ±è¡¨ç¤º
    â†“
ã€Œç·¨é›†ã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    â†“
AvatarEditScreenè¡¨ç¤º
    â†“
å¤–è¦‹ãƒ»æ€§æ ¼å¤‰æ›´
    â†“
ã€Œæ›´æ–°ã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    â†“
APIå‘¼ã³å‡ºã—ï¼ˆPUT /api/avatarï¼‰
    â†“
æˆåŠŸæ™‚ã«å‰ç”»é¢ã¸æˆ»ã‚‹
```

#### 2.2.2 è¡¨ç¤ºå†…å®¹

**AvatarManageScreenï¼ˆç®¡ç†ç”»é¢ï¼‰**:
- ã‚¢ãƒã‚¿ãƒ¼ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆç”Ÿæˆæ¸ˆã¿ã®å ´åˆï¼‰
- ç”Ÿæˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
  - `pending`: "ç”»åƒç”Ÿæˆä¸­..."ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼‰
  - `completed`: ã‚¢ãƒã‚¿ãƒ¼ç”»åƒè¡¨ç¤º
  - `failed`: "ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ"ï¼ˆå†ç”Ÿæˆãƒœã‚¿ãƒ³ï¼‰
- å¤–è¦‹ãƒ»æ€§æ ¼ã®ç¾åœ¨è¨­å®šå€¤
- ç·¨é›†ãƒœã‚¿ãƒ³
- ç”»åƒå†ç”Ÿæˆãƒœã‚¿ãƒ³
- å‰Šé™¤ãƒœã‚¿ãƒ³
- è¡¨ç¤ºON/OFFãƒˆã‚°ãƒ«

**AvatarEditScreenï¼ˆç·¨é›†ç”»é¢ï¼‰**:
- AvatarCreateScreenã¨åŒã˜UI
- ç¾åœ¨ã®è¨­å®šå€¤ãŒåˆæœŸå€¤ã¨ã—ã¦è¡¨ç¤º

#### 2.2.3 ç”»åƒå†ç”Ÿæˆæ©Ÿèƒ½

```
AvatarManageScreen
    â†“
ã€Œç”»åƒã‚’å†ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    â†“
ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
ã€Œç”»åƒã‚’å†ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿï¼ˆãƒˆãƒ¼ã‚¯ãƒ³50,000æ¶ˆè²»ï¼‰ã€
    â†“
ã€Œå†ç”Ÿæˆã€ã‚¿ãƒƒãƒ—
    â†“
APIå‘¼ã³å‡ºã—ï¼ˆPOST /api/avatar/regenerateï¼‰
    â†“
ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å†ç”Ÿæˆé–‹å§‹
    â†“
å³åº§ã«å‰ç”»é¢ã¸æˆ»ã‚‹
    â†“
ç”Ÿæˆå®Œäº†æ™‚ã«é€šçŸ¥
```

### 2.3 ã‚¢ãƒã‚¿ãƒ¼å‰Šé™¤æ©Ÿèƒ½

```
AvatarManageScreen
    â†“
ã€Œå‰Šé™¤ã€ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
    â†“
ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
ã€Œã‚¢ãƒã‚¿ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã€
    â†“
ã€Œå‰Šé™¤ã€ã‚¿ãƒƒãƒ—
    â†“
APIå‘¼ã³å‡ºã—ï¼ˆDELETE /api/avatarï¼‰
    â†“
æˆåŠŸæ™‚ã«ãƒ›ãƒ¼ãƒ ç”»é¢ã¸é·ç§»
```

### 2.4 ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºè¨­å®š

```
AvatarManageScreen
    â†“
è¡¨ç¤ºON/OFFãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒ
    â†“
åˆ‡ã‚Šæ›¿ãˆæ™‚ã«APIå‘¼ã³å‡ºã—ï¼ˆPATCH /api/avatar/visibilityï¼‰
    â†“
æˆåŠŸæ™‚ã«ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
```

---

## 3. ç”»é¢è¨­è¨ˆ

### 3.1 AvatarCreateScreenï¼ˆã‚¢ãƒã‚¿ãƒ¼ä½œæˆç”»é¢ï¼‰

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ã‚¢ãƒã‚¿ãƒ¼ä½œæˆ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚ ğŸ‘¤ å¤–è¦‹ã®è¨­å®š                    â”‚
â”‚                                 â”‚
â”‚ æ€§åˆ¥:        [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ é«ªå‹:        [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ é«ªã®è‰²:      [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ ç›®ã®è‰²:      [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ æœè£…:        [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼: [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚                                 â”‚
â”‚ ğŸ’¬ æ€§æ ¼ã®è¨­å®š                    â”‚
â”‚                                 â”‚
â”‚ å£èª¿:        [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ ç†±æ„:        [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ ä¸å¯§ã•:      [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚ ãƒ¦ãƒ¼ãƒ¢ã‚¢:    [ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]         â”‚
â”‚                                 â”‚
â”‚ âš ï¸ ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»: 100,000         â”‚
â”‚                                 â”‚
â”‚        [ä½œæˆã™ã‚‹]                 â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ†ãƒ¼ãƒå¯¾å¿œ**:
- `adult`: é€šå¸¸UIï¼ˆç´«ç³»ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- `child`: å­ã©ã‚‚å‘ã‘ã‚«ãƒ©ãƒ¼ï¼ˆé»„è‰²ãƒ»ã‚ªãƒ¬ãƒ³ã‚¸ç³»ï¼‰

### 3.2 AvatarManageScreenï¼ˆã‚¢ãƒã‚¿ãƒ¼ç®¡ç†ç”»é¢ï¼‰

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç”Ÿæˆå®Œäº†æ™‚ï¼‰**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ã‚¢ãƒã‚¿ãƒ¼è¨­å®š                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚    [ã‚¢ãƒã‚¿ãƒ¼ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼]        â”‚
â”‚         (250x300px)             â”‚
â”‚                                 â”‚
â”‚ è¡¨ç¤ºè¨­å®š: [ON/OFF ãƒˆã‚°ãƒ«]         â”‚
â”‚                                 â”‚
â”‚ å¤–è¦‹ã®è¨­å®š                       â”‚
â”‚ â”œ æ€§åˆ¥: å¥³æ€§                     â”‚
â”‚ â”œ é«ªå‹: ãƒ­ãƒ³ã‚°                   â”‚
â”‚ â”œ é«ªã®è‰²: èŒ¶                     â”‚
â”‚ â”” ...                           â”‚
â”‚                                 â”‚
â”‚ æ€§æ ¼ã®è¨­å®š                       â”‚
â”‚ â”œ å£èª¿: å„ªã—ã„                   â”‚
â”‚ â”œ ç†±æ„: é«˜ã„                     â”‚
â”‚ â”” ...                           â”‚
â”‚                                 â”‚
â”‚        [ç·¨é›†ã™ã‚‹]                 â”‚
â”‚     [ç”»åƒã‚’å†ç”Ÿæˆ]                â”‚
â”‚        [å‰Šé™¤ã™ã‚‹]                 â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç”Ÿæˆä¸­ï¼‰**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ã‚¢ãƒã‚¿ãƒ¼è¨­å®š                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚    [ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼]          â”‚
â”‚                                 â”‚
â”‚ ç”»åƒç”Ÿæˆä¸­...                    â”‚
â”‚                                 â”‚
â”‚ [â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”] 60%   â”‚
â”‚                                 â”‚
â”‚ ç”Ÿæˆã«ã¯æ•°åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚           â”‚
â”‚ å®Œäº†æ™‚ã«é€šçŸ¥ã§ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚     â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 AvatarEditScreenï¼ˆã‚¢ãƒã‚¿ãƒ¼ç·¨é›†ç”»é¢ï¼‰

- AvatarCreateScreenã¨åŒä¸€UI
- åˆæœŸå€¤ã«ç¾åœ¨ã®è¨­å®šå€¤ã‚’è¡¨ç¤º
- ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: "æ›´æ–°ã™ã‚‹"

---

## 4. APIä»•æ§˜

### 4.1 ã‚¢ãƒã‚¿ãƒ¼ä½œæˆ

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/avatar`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "sex": "female",
  "hair_style": "long",
  "hair_color": "brown",
  "eye_color": "brown",
  "clothing": "teacher_uniform",
  "accessory": "glasses",
  "tone": "kind",
  "enthusiasm": "high",
  "formality": "polite",
  "humor": "present"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ã‚¢ãƒã‚¿ãƒ¼ã®ä½œæˆã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚ç”»åƒç”Ÿæˆã«ã¯æ•°åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚",
  "data": {
    "avatar": {
      "id": 1,
      "user_id": 123,
      "generation_status": "pending",
      "is_visible": true,
      ...
    }
  }
}
```

**å®Ÿè£…çŠ¶æ³**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ`StoreTeacherAvatarApiAction`ï¼‰

### 4.2 ã‚¢ãƒã‚¿ãƒ¼å–å¾—

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/avatar`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "data": {
    "avatar": {
      "id": 1,
      "user_id": 123,
      "sex": "female",
      "generation_status": "completed",
      "is_visible": true,
      "images": [
        {
          "id": 1,
          "image_type": "full_body",
          "emotion": "neutral",
          "image_url": "https://..."
        },
        ...
      ],
      ...
    }
  }
}
```

**å®Ÿè£…çŠ¶æ³**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ`ShowTeacherAvatarApiAction`ï¼‰

### 4.3 ã‚¢ãƒã‚¿ãƒ¼æ›´æ–°

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `PUT /api/avatar`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**: POST /api/avatarã¨åŒã˜

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ã‚¢ãƒã‚¿ãƒ¼è¨­å®šã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚",
  "data": {
    "avatar": { ... }
  }
}
```

**å®Ÿè£…çŠ¶æ³**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ`UpdateTeacherAvatarApiAction`ï¼‰

### 4.4 ã‚¢ãƒã‚¿ãƒ¼å‰Šé™¤

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `DELETE /api/avatar`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ã‚¢ãƒã‚¿ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚"
}
```

**å®Ÿè£…çŠ¶æ³**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ`DestroyTeacherAvatarApiAction`ï¼‰

### 4.5 ç”»åƒå†ç”Ÿæˆ

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `POST /api/avatar/regenerate`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ã‚¢ãƒã‚¿ãƒ¼ç”»åƒã®å†ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚å®Œäº†ã«ã¯æ•°åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚",
  "data": {
    "avatar": {
      "generation_status": "pending",
      ...
    }
  }
}
```

**å®Ÿè£…çŠ¶æ³**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ`RegenerateAvatarImageApiAction`ï¼‰

### 4.6 è¡¨ç¤ºè¨­å®šåˆ‡æ›¿

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `PATCH /api/avatar/visibility`

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```json
{
  "success": true,
  "message": "ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºã‚’ONã«ã—ã¾ã—ãŸã€‚",
  "data": {
    "avatar": {
      "is_visible": true,
      ...
    }
  }
}
```

**å®Ÿè£…çŠ¶æ³**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ`ToggleAvatarVisibilityApiAction`ï¼‰

### 4.7 ã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ï¼ˆPhase 2.B-5 Step 3å®Ÿè£…æ¸ˆã¿ï¼‰

**ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: `GET /api/avatar/comment/{event}`

**å®Ÿè£…çŠ¶æ³**: âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆ`GetAvatarCommentApiAction`ï¼‰

---

## 5. ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ

### 5.1 å‹å®šç¾©ï¼ˆavatar.types.tsï¼‰

```typescript
/**
 * ã‚¢ãƒã‚¿ãƒ¼åŸºæœ¬æƒ…å ±
 */
export interface Avatar {
  id: number;
  user_id: number;
  seed: number;
  sex: AvatarSex;
  hair_style: AvatarHairStyle;
  hair_color: AvatarHairColor;
  eye_color: AvatarEyeColor;
  clothing: AvatarClothing;
  accessory: AvatarAccessory | null;
  tone: AvatarTone;
  enthusiasm: AvatarEnthusiasm;
  formality: AvatarFormality;
  humor: AvatarHumor;
  draw_model_version: string;
  is_transparent: boolean;
  is_chibi: boolean;
  estimated_token_usage: number;
  generation_status: AvatarGenerationStatus;
  last_generated_at: string | null;
  is_visible: boolean;
  created_at: string;
  updated_at: string;
  images: AvatarImage[];
}

/**
 * ã‚¢ãƒã‚¿ãƒ¼ç”»åƒ
 */
export interface AvatarImage {
  id: number;
  image_type: 'full_body' | 'bust';
  emotion: 'neutral' | 'happy' | 'sad' | 'angry';
  image_url: string;
  created_at: string;
}

/**
 * ç”Ÿæˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
 */
export type AvatarGenerationStatus = 'pending' | 'processing' | 'completed' | 'failed';

/**
 * æ€§åˆ¥
 */
export type AvatarSex = 'male' | 'female' | 'neutral';

/**
 * é«ªå‹
 */
export type AvatarHairStyle = 'short' | 'medium' | 'long' | 'two_side';

/**
 * é«ªã®è‰²
 */
export type AvatarHairColor = 'black' | 'brown' | 'blonde' | 'red' | 'blue' | 'green' | 'purple' | 'pink' | 'white';

/**
 * ç›®ã®è‰²
 */
export type AvatarEyeColor = 'black' | 'brown' | 'blue' | 'green' | 'hazel' | 'gray';

/**
 * æœè£…
 */
export type AvatarClothing = 'suit' | 'casual' | 'teacher_uniform' | 'scholar';

/**
 * ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼
 */
export type AvatarAccessory = 'none' | 'glasses' | 'tie' | 'earring';

/**
 * å£èª¿
 */
export type AvatarTone = 'kind' | 'strict' | 'frank' | 'polite';

/**
 * ç†±æ„
 */
export type AvatarEnthusiasm = 'high' | 'normal' | 'reserved';

/**
 * ä¸å¯§ã•
 */
export type AvatarFormality = 'polite' | 'normal' | 'casual';

/**
 * ãƒ¦ãƒ¼ãƒ¢ã‚¢
 */
export type AvatarHumor = 'present' | 'absent';

/**
 * ã‚¢ãƒã‚¿ãƒ¼ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
 */
export interface CreateAvatarRequest {
  sex: AvatarSex;
  hair_style: AvatarHairStyle;
  hair_color: AvatarHairColor;
  eye_color: AvatarEyeColor;
  clothing: AvatarClothing;
  accessory?: AvatarAccessory;
  tone: AvatarTone;
  enthusiasm: AvatarEnthusiasm;
  formality: AvatarFormality;
  humor: AvatarHumor;
}

/**
 * ã‚¢ãƒã‚¿ãƒ¼æ›´æ–°ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
 */
export interface UpdateAvatarRequest extends CreateAvatarRequest {}
```

### 5.2 è¨­å®šå€¤å®šç¾©ï¼ˆconstants.tsï¼‰

```typescript
/**
 * ã‚¢ãƒã‚¿ãƒ¼è¨­å®šå€¤
 */
export const AVATAR_OPTIONS = {
  sex: [
    { value: 'male', label: 'ç”·æ€§', emoji: 'ğŸ‘¨' },
    { value: 'female', label: 'å¥³æ€§', emoji: 'ğŸ‘©' },
    { value: 'neutral', label: 'ä¸­æ€§', emoji: 'ğŸ§‘' },
  ],
  hair_style: [
    { value: 'short', label: 'ã‚·ãƒ§ãƒ¼ãƒˆ' },
    { value: 'medium', label: 'ãƒŸãƒ‡ã‚£ã‚¢ãƒ ' },
    { value: 'long', label: 'ãƒ­ãƒ³ã‚°' },
    { value: 'two_side', label: 'ãƒ„ãƒ¼ã‚µã‚¤ãƒ‰' },
  ],
  hair_color: [
    { value: 'black', label: 'é»’' },
    { value: 'brown', label: 'èŒ¶' },
    { value: 'blonde', label: 'é‡‘' },
    { value: 'red', label: 'èµ¤' },
    { value: 'blue', label: 'é’' },
    { value: 'green', label: 'ç·‘' },
    { value: 'purple', label: 'ç´«' },
    { value: 'pink', label: 'ãƒ”ãƒ³ã‚¯' },
    { value: 'white', label: 'ç™½' },
  ],
  // ... ä»–ã®è¨­å®šå€¤
};
```

---

## 6. Serviceãƒ»Hookå±¤è¨­è¨ˆ

### 6.1 AvatarServiceï¼ˆavatar.service.tsï¼‰

```typescript
/**
 * ã‚¢ãƒã‚¿ãƒ¼ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
 */
export const avatarService = {
  /**
   * ã‚¢ãƒã‚¿ãƒ¼å–å¾—
   */
  async getAvatar(): Promise<Avatar> { /* ... */ },
  
  /**
   * ã‚¢ãƒã‚¿ãƒ¼ä½œæˆ
   */
  async createAvatar(data: CreateAvatarRequest): Promise<Avatar> { /* ... */ },
  
  /**
   * ã‚¢ãƒã‚¿ãƒ¼æ›´æ–°
   */
  async updateAvatar(data: UpdateAvatarRequest): Promise<Avatar> { /* ... */ },
  
  /**
   * ã‚¢ãƒã‚¿ãƒ¼å‰Šé™¤
   */
  async deleteAvatar(): Promise<void> { /* ... */ },
  
  /**
   * ç”»åƒå†ç”Ÿæˆ
   */
  async regenerateImages(): Promise<Avatar> { /* ... */ },
  
  /**
   * è¡¨ç¤ºè¨­å®šåˆ‡æ›¿
   */
  async toggleVisibility(): Promise<Avatar> { /* ... */ },
  
  /**
   * ã‚¤ãƒ™ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆå–å¾—ï¼ˆPhase 2.B-5 Step 3å®Ÿè£…æ¸ˆã¿ï¼‰
   */
  async getCommentForEvent(eventType: AvatarEventType): Promise<AvatarCommentResponse> { /* ... */ },
};
```

### 6.2 useAvatar Hookï¼ˆuseAvatar.tsï¼‰

```typescript
/**
 * ã‚¢ãƒã‚¿ãƒ¼ç®¡ç†Hook
 */
export const useAvatar = () => {
  const [avatar, setAvatar] = useState<Avatar | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  /**
   * ã‚¢ãƒã‚¿ãƒ¼å–å¾—
   */
  const getAvatar = async () => { /* ... */ };
  
  /**
   * ã‚¢ãƒã‚¿ãƒ¼ä½œæˆ
   */
  const createAvatar = async (data: CreateAvatarRequest) => { /* ... */ };
  
  /**
   * ã‚¢ãƒã‚¿ãƒ¼æ›´æ–°
   */
  const updateAvatar = async (data: UpdateAvatarRequest) => { /* ... */ };
  
  /**
   * ã‚¢ãƒã‚¿ãƒ¼å‰Šé™¤
   */
  const deleteAvatar = async () => { /* ... */ };
  
  /**
   * ç”»åƒå†ç”Ÿæˆ
   */
  const regenerateImages = async () => { /* ... */ };
  
  /**
   * è¡¨ç¤ºè¨­å®šåˆ‡æ›¿
   */
  const toggleVisibility = async () => { /* ... */ };
  
  return {
    avatar,
    isLoading,
    error,
    getAvatar,
    createAvatar,
    updateAvatar,
    deleteAvatar,
    regenerateImages,
    toggleVisibility,
  };
};
```

---

## 7. ãƒ†ã‚¹ãƒˆè¦ä»¶

### 7.1 Serviceãƒ†ã‚¹ãƒˆï¼ˆavatar.service.test.tsï¼‰

- âœ… ã‚¢ãƒã‚¿ãƒ¼å–å¾—æˆåŠŸ
- âœ… ã‚¢ãƒã‚¿ãƒ¼ä½œæˆæˆåŠŸ
- âœ… ã‚¢ãƒã‚¿ãƒ¼æ›´æ–°æˆåŠŸ
- âœ… ã‚¢ãƒã‚¿ãƒ¼å‰Šé™¤æˆåŠŸ
- âœ… ç”»åƒå†ç”ŸæˆæˆåŠŸ
- âœ… è¡¨ç¤ºè¨­å®šåˆ‡æ›¿æˆåŠŸ
- âœ… APIã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**ç›®æ¨™**: 8ãƒ†ã‚¹ãƒˆã€å…¨ãƒ‘ã‚¹

### 7.2 Hookãƒ†ã‚¹ãƒˆï¼ˆuseAvatar.test.tsï¼‰

- âœ… ã‚¢ãƒã‚¿ãƒ¼å–å¾—
- âœ… ã‚¢ãƒã‚¿ãƒ¼ä½œæˆï¼ˆæˆåŠŸãƒ»å¤±æ•—ï¼‰
- âœ… ã‚¢ãƒã‚¿ãƒ¼æ›´æ–°ï¼ˆæˆåŠŸãƒ»å¤±æ•—ï¼‰
- âœ… ã‚¢ãƒã‚¿ãƒ¼å‰Šé™¤ï¼ˆæˆåŠŸãƒ»å¤±æ•—ï¼‰
- âœ… ç”»åƒå†ç”Ÿæˆï¼ˆæˆåŠŸãƒ»å¤±æ•—ï¼‰
- âœ… è¡¨ç¤ºè¨­å®šåˆ‡æ›¿ï¼ˆæˆåŠŸãƒ»å¤±æ•—ï¼‰
- âœ… ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ç®¡ç†
- âœ… ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ç®¡ç†

**ç›®æ¨™**: 12ãƒ†ã‚¹ãƒˆã€å…¨ãƒ‘ã‚¹

### 7.3 UIãƒ†ã‚¹ãƒˆ

**AvatarCreateScreen.test.tsx**:
- âœ… ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
- âœ… å…¥åŠ›å€¤å¤‰æ›´
- âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- âœ… é€ä¿¡æˆåŠŸæ™‚ã®æŒ™å‹•
- âœ… é€ä¿¡å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- âœ… ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ

**AvatarManageScreen.test.tsx**:
- âœ… ã‚¢ãƒã‚¿ãƒ¼æƒ…å ±è¡¨ç¤º
- âœ… ç”Ÿæˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
- âœ… ç·¨é›†ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—
- âœ… å†ç”Ÿæˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- âœ… å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- âœ… è¡¨ç¤ºON/OFFåˆ‡æ›¿

**AvatarEditScreen.test.tsx**:
- âœ… åˆæœŸå€¤è¡¨ç¤º
- âœ… æ›´æ–°æˆåŠŸæ™‚ã®æŒ™å‹•

**ç›®æ¨™**: 20ãƒ†ã‚¹ãƒˆã€å…¨ãƒ‘ã‚¹

---

## 8. å®Ÿè£…å„ªå…ˆé †ä½

### Phase 2.B-7 Week 1ï¼ˆã‚¢ãƒã‚¿ãƒ¼ç®¡ç†ï¼‰

1. **å‹å®šç¾©ä½œæˆ**ï¼ˆ1æ—¥ï¼‰
   - `avatar.types.ts` ä½œæˆ
   - `constants.ts` ã«AVATAR_OPTIONSè¿½åŠ 

2. **Serviceå±¤å®Ÿè£…**ï¼ˆ2æ—¥ï¼‰
   - `avatar.service.ts` å®Ÿè£…ï¼ˆ7ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
   - `avatar.service.test.ts` ä½œæˆï¼ˆ8ãƒ†ã‚¹ãƒˆï¼‰

3. **Hookå±¤å®Ÿè£…**ï¼ˆ2æ—¥ï¼‰
   - `useAvatar.ts` å®Ÿè£…ï¼ˆ7ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
   - `useAvatar.test.ts` ä½œæˆï¼ˆ12ãƒ†ã‚¹ãƒˆï¼‰

4. **UIå®Ÿè£…**ï¼ˆ2æ—¥ï¼‰
   - `AvatarCreateScreen.tsx` å®Ÿè£…
   - `AvatarManageScreen.tsx` å®Ÿè£…
   - `AvatarEditScreen.tsx` å®Ÿè£…
   - UIãƒ†ã‚¹ãƒˆä½œæˆï¼ˆ20ãƒ†ã‚¹ãƒˆï¼‰

---

## 9. å‚è€ƒè³‡æ–™

- **Webç‰ˆè¦ä»¶å®šç¾©**: `/home/ktr/mtdev/definitions/AvatarDefinition.md`
- **Webç‰ˆã‚¢ãƒã‚¿ãƒ¼ä½œæˆç”»é¢**: `/home/ktr/mtdev/resources/views/avatars/create.blade.php`
- **Webç‰ˆã‚¢ãƒã‚¿ãƒ¼ç·¨é›†ç”»é¢**: `/home/ktr/mtdev/resources/views/avatars/edit.blade.php`
- **Laravel APIå®Ÿè£…**: `/home/ktr/mtdev/app/Http/Actions/Api/Avatar/`
- **ãƒ¢ãƒã‚¤ãƒ«é–‹ç™ºè¦å‰‡**: `/home/ktr/mtdev/docs/mobile/mobile-rules.md`
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦ç´„**: `/home/ktr/mtdev/.github/copilot-instructions.md`
- **Phase 2.B-5 Step 3å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ**: `/home/ktr/mtdev/docs/reports/2025-12-07-avatar-implementation-completion-report.md`
