# Phase 1.1.1 å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»è¨­å®š

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | æ›´æ–°è€… | æ›´æ–°å†…å®¹ |
|------|--------|---------|
| 2025-11-30 | GitHub Copilot | åˆç‰ˆä½œæˆ: Phase 1.1.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»è¨­å®šå®Œäº† |

## æ¦‚è¦

MyTeacherã‚¢ãƒ—ãƒªã«**Stripeèª²é‡‘ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µã¨è¨­å®šï¼‰**ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ã“ã®ä½œæ¥­ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®ç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸï¼š

- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç›¤æ§‹ç¯‰**: groupsãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰9ã‚«ãƒ©ãƒ è¿½åŠ 
- âœ… **å®Ÿç¸¾ãƒ¬ãƒãƒ¼ãƒˆåŸºç›¤**: monthly_reportsãƒ†ãƒ¼ãƒ–ãƒ«æ–°è¦ä½œæˆï¼ˆæœˆæ¬¡é›†è¨ˆä¿å­˜ç”¨ï¼‰
- âœ… **ãƒ—ãƒ©ãƒ³å®šç¾©æ•´å‚™**: ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒ—ãƒ©ãƒ³ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³ã®ä½“ç³»åŒ–
- âœ… **ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ**: Groupãƒ»MonthlyReportãƒ¢ãƒ‡ãƒ«ã®æº–å‚™å®Œäº†
- âœ… **ç’°å¢ƒè¨­å®š**: Stripeä¾¡æ ¼IDç”¨ã®ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¿½åŠ 

---

## è¨ˆç”»ã¨ã®å¯¾å¿œ

**å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/plans/phase1-1-stripe-subscription-plan.md`

| è¨ˆç”»é …ç›® | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | å®Ÿæ–½å†…å®¹ | å·®ç•°ãƒ»å‚™è€ƒ |
|---------|-----------|---------|-----------|
| Phase 1.1.1: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆãƒ»å®Ÿè¡Œ | âœ… å®Œäº† | è¨ˆç”»é€šã‚Šå®Ÿæ–½ | ãªã— |
| Phase 1.1.1: Stripeå•†å“ãƒ»ä¾¡æ ¼ä½œæˆ | âš ï¸ ä¸€éƒ¨ä¿ç•™ | ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¨­å®š | å®Ÿéš›ã®å•†å“ä½œæˆã¯Phase 1.1.2ã§å®Ÿæ–½ï¼ˆStripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ“ä½œãŒå¿…è¦ï¼‰ |
| Phase 1.1.1: ç’°å¢ƒå¤‰æ•°è¨­å®š | âœ… å®Œäº† | è¨ˆç”»é€šã‚Šå®Ÿæ–½ | ãªã— |
| Phase 1.1.1: config/const.phpã«ãƒ—ãƒ©ãƒ³å®šæ•°è¿½åŠ  | âœ… å®Œäº† | è¨ˆç”»é€šã‚Šå®Ÿæ–½ | ãªã— |

---

## å®Ÿæ–½å†…å®¹è©³ç´°

### å®Œäº†ã—ãŸä½œæ¥­

#### 1. groupsãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `database/migrations/2025_11_30_111950_add_subscription_fields_to_groups_table.php`

- **å®Ÿæ–½å†…å®¹**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†ã«å¿…è¦ãª9ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
- **ä½¿ç”¨ã‚³ãƒãƒ³ãƒ‰**: `php artisan make:migration add_subscription_fields_to_groups_table --table=groups`
- **æˆæœç‰©**: 
  - up()ãƒ¡ã‚½ãƒƒãƒ‰: ã‚«ãƒ©ãƒ è¿½åŠ ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
  - down()ãƒ¡ã‚½ãƒƒãƒ‰: ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

**è¿½åŠ ã‚«ãƒ©ãƒ è©³ç´°**:
- `subscription_active` (boolean, default: false): ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æœ‰åŠ¹ãƒ•ãƒ©ã‚°
- `subscription_plan` (varchar 50, nullable): ãƒ—ãƒ©ãƒ³ç¨®åˆ¥ï¼ˆ'family'/'enterprise'ï¼‰
- `max_members` (integer, default: 6): ãƒ¡ãƒ³ãƒãƒ¼ä¸Šé™æ•°
- `max_groups` (integer, default: 1): ã‚°ãƒ«ãƒ¼ãƒ—ä¸Šé™æ•°
- `free_group_task_limit` (integer, default: 3): æœˆæ¬¡ç„¡æ–™ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯ä¸Šé™
- `group_task_count_current_month` (integer, default: 0): å½“æœˆã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯ã‚«ã‚¦ãƒ³ãƒˆ
- `group_task_count_reset_at` (timestamp, nullable): ã‚«ã‚¦ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆæ—¥æ™‚
- `free_trial_days` (integer, default: 14): ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“ï¼ˆæ—¥æ•°ï¼‰
- `report_enabled_until` (date, nullable): ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½æœ‰åŠ¹æœŸé™

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `groups_subscription_active_index`: subscription_activeã‚«ãƒ©ãƒ 
- `groups_group_task_count_reset_at_index`: group_task_count_reset_atã‚«ãƒ©ãƒ 

**åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š**:
```sql
UPDATE groups 
SET group_task_count_reset_at = DATE_TRUNC('month', NOW() + INTERVAL '1 month')
WHERE group_task_count_reset_at IS NULL;

UPDATE groups 
SET report_enabled_until = DATE_TRUNC('month', NOW() + INTERVAL '1 month') - INTERVAL '1 day'
WHERE report_enabled_until IS NULL AND subscription_active = FALSE;
```

**å®Ÿè¡Œçµæœ**: 26.25ms

---

#### 2. monthly_reportsãƒ†ãƒ¼ãƒ–ãƒ«æ–°è¦ä½œæˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `database/migrations/2025_11_30_112052_create_monthly_reports_table.php`

- **å®Ÿæ–½å†…å®¹**: æœˆæ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- **ä½¿ç”¨ã‚³ãƒãƒ³ãƒ‰**: `php artisan make:migration create_monthly_reports_table --create=monthly_reports`
- **æˆæœç‰©**: 14ã‚«ãƒ©ãƒ ã®ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã€å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã€ä¸€æ„åˆ¶ç´„

**ã‚«ãƒ©ãƒ æ§‹æˆ**:
- `id` (bigserial, PRIMARY KEY): ãƒ¬ãƒãƒ¼ãƒˆID
- `group_id` (bigint, NOT NULL, FOREIGN KEY): ã‚°ãƒ«ãƒ¼ãƒ—ID
- `report_month` (date, NOT NULL): ãƒ¬ãƒãƒ¼ãƒˆå¯¾è±¡æœˆï¼ˆYYYY-MM-01å½¢å¼ï¼‰
- `generated_at` (timestamp, nullable): ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ—¥æ™‚
- `member_task_summary` (json, nullable): ãƒ¡ãƒ³ãƒãƒ¼åˆ¥ã‚¿ã‚¹ã‚¯é›†è¨ˆ
- `group_task_completed_count` (integer, default: 0): ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯å®Œäº†ä»¶æ•°
- `group_task_total_reward` (integer, default: 0): ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯ç²å¾—å ±é…¬åˆè¨ˆ
- `group_task_details` (json, nullable): ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯å®Œäº†å†…è¨³
- `normal_task_count_previous_month` (integer, default: 0): å‰æœˆé€šå¸¸ã‚¿ã‚¹ã‚¯å®Œäº†ä»¶æ•°
- `group_task_count_previous_month` (integer, default: 0): å‰æœˆã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯å®Œäº†ä»¶æ•°
- `reward_previous_month` (integer, default: 0): å‰æœˆç²å¾—å ±é…¬
- `pdf_path` (varchar 255, nullable): PDFãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆS3ï¼‰
- `created_at` / `updated_at`: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

**åˆ¶ç´„**:
- å¤–éƒ¨ã‚­ãƒ¼: `group_id` â†’ `groups.id` (CASCADEå‰Šé™¤)
- ä¸€æ„åˆ¶ç´„: `(group_id, report_month)` - 1ã‚°ãƒ«ãƒ¼ãƒ—1ãƒ¶æœˆ1ãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿè¡Œçµæœ**: 25.43ms

---

#### 3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

**ã‚³ãƒãƒ³ãƒ‰**: `docker exec mtdev-app-1 php artisan migrate`

**å®Ÿè¡Œçµæœ**:
```bash
INFO  Running migrations.

2025_11_30_000001_fix_scheduled_task_executions_columns ....... 37.48ms DONE
2025_11_30_111907_add_subscription_fields_to_groups_table ...... 0.67ms DONE
2025_11_30_111950_add_subscription_fields_to_groups_table ..... 26.25ms DONE
2025_11_30_112052_create_monthly_reports_table ................ 25.43ms DONE
```
- ç·å®Ÿè¡Œæ™‚é–“: 89.83ms
- 4ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå®Œäº†

---

#### 4. config/const.phpè¨­å®šè¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `config/const.php`

- **å®Ÿæ–½å†…å®¹**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³å®šç¾©ã‚’è¿½åŠ 
- **æˆæœç‰©**: stripeã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã«3ã¤ã®ä¸»è¦è¨­å®š

**è¨­å®šå†…å®¹**:

1. **ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³å®šç¾©**:
   - ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒ—ãƒ©ãƒ³: Â¥500/æœˆã€æœ€å¤§6åã€ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯ç„¡åˆ¶é™
   - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³: Â¥3,000/æœˆï¼ˆåŸºæœ¬20åï¼‰ã€æœ€å¤§5ã‚°ãƒ«ãƒ¼ãƒ—
   - ä¸¡ãƒ—ãƒ©ãƒ³å…±é€š: 14æ—¥é–“ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ«ã€æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½

2. **è¿½åŠ ãƒ¡ãƒ³ãƒãƒ¼èª²é‡‘è¨­å®š**:
   - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³ã§20åè¶…éæ™‚: Â¥150/æœˆ/å

3. **ç„¡æ–™ãƒ—ãƒ©ãƒ³åˆ¶é™**:
   - æœ€å¤§6åã€ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯æœˆ3å›ã¾ã§ã€ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯åˆæœˆã®ã¿

**ã‚³ãƒ¼ãƒ‰ä¾‹**:
```php
'stripe' => [
    'subscription_plans' => [
        'family' => [
            'name' => 'ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒ—ãƒ©ãƒ³',
            'price_id' => env('STRIPE_FAMILY_PLAN_PRICE_ID'),
            'amount' => 500,
            'max_members' => 6,
            'trial_days' => 14,
            // ...
        ],
        'enterprise' => [
            'name' => 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³',
            'price_id' => env('STRIPE_ENTERPRISE_PLAN_PRICE_ID'),
            'amount' => 3000,
            'max_members' => 20,
            'max_groups' => 5,
            // ...
        ],
    ],
    'additional_member_price_id' => env('STRIPE_ADDITIONAL_MEMBER_PRICE_ID'),
    'additional_member_amount' => 150,
    'free_plan' => [
        'max_members' => 6,
        'group_task_limit_per_month' => 3,
        // ...
    ],
],
```

---

#### 5. ç’°å¢ƒå¤‰æ•°ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«**: `.env`

- **å®Ÿæ–½å†…å®¹**: Stripeä¾¡æ ¼IDã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼å¤‰æ•°ã‚’è¿½åŠ 
- **æˆæœç‰©**: 3ã¤ã®ç’°å¢ƒå¤‰æ•°å®šç¾©

**è¿½åŠ å¤‰æ•°**:

```bash
# Stripe ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³ä¾¡æ ¼IDï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰
# â€» Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä½œæˆå¾Œã€å®Ÿéš›ã®ä¾¡æ ¼IDã«ç½®ãæ›ãˆã¦ãã ã•ã„
STRIPE_FAMILY_PLAN_PRICE_ID=price_test_family_placeholder
STRIPE_ENTERPRISE_PLAN_PRICE_ID=price_test_enterprise_placeholder
STRIPE_ADDITIONAL_MEMBER_PRICE_ID=price_test_additional_member_placeholder
```

**æ³¨æ„**: ç¾åœ¨ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã€‚Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å•†å“ãƒ»ä¾¡æ ¼ã‚’ä½œæˆå¾Œã€å®Ÿéš›ã®ä¾¡æ ¼IDã«ç½®ãæ›ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

**è¿½åŠ å¤‰æ•°**:
```bash
STRIPE_FAMILY_PLAN_PRICE_ID=price_test_family_placeholder
STRIPE_ENTERPRISE_PLAN_PRICE_ID=price_test_enterprise_placeholder
STRIPE_ADDITIONAL_MEMBER_PRICE_ID=price_test_additional_member_placeholder
```

**æ³¨æ„**: å®Ÿéš›ã®ä¾¡æ ¼IDã¯Phase 1.1.2ã§Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰å–å¾—ã—ã¦è¨­å®š

---

#### 6. ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/Models/Group.php`

- **å®Ÿæ–½å†…å®¹**: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’fillableãƒ»castsã«è¿½åŠ 
- **å¤‰æ›´ç®‡æ‰€**: fillableé…åˆ—ã«9é …ç›®è¿½åŠ ã€castsé…åˆ—ã«3é …ç›®è¿½åŠ 

**å¤‰æ›´å†…å®¹**:
```php
protected $fillable = [
    // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...
    'subscription_active',
    'subscription_plan',
    'max_members',
    'max_groups',
    'free_group_task_limit',
    'group_task_count_current_month',
    'group_task_count_reset_at',
    'free_trial_days',
    'report_enabled_until',
];

protected $casts = [
    // æ—¢å­˜ã‚­ãƒ£ã‚¹ãƒˆ...
    'subscription_active' => 'boolean',
    'group_task_count_reset_at' => 'datetime',
    'report_enabled_until' => 'date',
];
```

---

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/Models/MonthlyReport.php`ï¼ˆæ–°è¦ä½œæˆï¼‰

- **å®Ÿæ–½å†…å®¹**: æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”¨Eloquentãƒ¢ãƒ‡ãƒ«ä½œæˆ
- **ä½¿ç”¨ã‚³ãƒãƒ³ãƒ‰**: `php artisan make:model MonthlyReport`
- **æˆæœç‰©**: fillableãƒ»castså®šç¾©ã€groupãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

**ãƒ¢ãƒ‡ãƒ«å®šç¾©**:
```php
protected $fillable = [
    'group_id', 'report_month', 'generated_at',
    'member_task_summary', 'group_task_completed_count',
    'group_task_total_reward', 'group_task_details',
    'normal_task_count_previous_month', 'group_task_count_previous_month',
    'reward_previous_month', 'pdf_path',
];

protected $casts = [
    'report_month' => 'date',
    'generated_at' => 'datetime',
    'member_task_summary' => 'array',  // JSON â†’ array
    'group_task_details' => 'array',    // JSON â†’ array
    // integerå‹ã‚­ãƒ£ã‚¹ãƒˆçœç•¥ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‡¦ç†ï¼‰
];

public function group(): BelongsTo {
    return $this->belongsTo(Group::class);
}
```

---

## æˆæœã¨åŠ¹æœ

### å®šé‡çš„åŠ¹æœ
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¤‰æ›´**: 2ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆgroupsæ‹¡å¼µ + monthly_reportsæ–°è¦ï¼‰
- **ã‚«ãƒ©ãƒ è¿½åŠ **: groups 9ã‚«ãƒ©ãƒ ã€monthly_reports 14ã‚«ãƒ©ãƒ 
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ **: 4å€‹ï¼ˆgroups 2å€‹ã€monthly_reports 2å€‹ï¼‰
- **åˆ¶ç´„è¿½åŠ **: å¤–éƒ¨ã‚­ãƒ¼1å€‹ã€ä¸€æ„åˆ¶ç´„1å€‹
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ™‚é–“**: 89.83msï¼ˆ4ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´**: config/const.php 1ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆç´„80è¡Œè¿½åŠ ï¼‰
- **ç’°å¢ƒå¤‰æ•°è¿½åŠ **: 3å€‹ï¼ˆStripeä¾¡æ ¼IDç”¨ï¼‰
- **ãƒ¢ãƒ‡ãƒ«å¤‰æ›´**: 2ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆGroupæ‹¡å¼µ + MonthlyReportæ–°è¦ï¼‰

### å®šæ€§çš„åŠ¹æœ
- âœ… ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†ã®åŸºç›¤ç¢ºç«‹
- âœ… æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®åŸºç¤è¨­è¨ˆå®Œäº†
- âœ… ãƒ—ãƒ©ãƒ³å®šç¾©ã®ä¸­å¤®é›†ç´„åŒ–ï¼ˆconfig/const.phpï¼‰
- âœ… æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¸ã®å½±éŸ¿ãªã—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®šæ¸ˆã¿ï¼‰
- âœ… ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œå®Œå‚™ï¼ˆdown()ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…ï¼‰
- âœ… PostgreSQLæœ€é©åŒ–ï¼ˆDATE_TRUNCã€INTERVALä½¿ç”¨ï¼‰

---

## æœªå®Œäº†é …ç›®ãƒ»æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### æ‰‹å‹•å®Ÿæ–½ãŒå¿…è¦ãªä½œæ¥­

- [ ] **Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å•†å“ãƒ»ä¾¡æ ¼ä½œæˆ**
  - ç†ç”±: APIçµŒç”±ã§ã®ä½œæˆã‚‚å¯èƒ½ã ãŒã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã®å¯è¦–åŒ–ãƒ»ç®¡ç†ãŒæ¨å¥¨
  - æ‰‹é †: 
    1. Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ å•†å“ â†’ æ–°è¦ä½œæˆ
    2. ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒ—ãƒ©ãƒ³: Â¥500/æœˆã€14æ—¥é–“ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è¨­å®š
    3. ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³: Â¥3,000/æœˆã€14æ—¥é–“ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è¨­å®š
    4. è¿½åŠ ãƒ¡ãƒ³ãƒãƒ¼ç”¨ä¾¡æ ¼: Â¥150/æœˆ
    5. å„ä¾¡æ ¼IDã‚’`.env`ã«åæ˜ 

- [ ] **ç’°å¢ƒå¤‰æ•°ã«å®Ÿéš›ã®Stripeä¾¡æ ¼IDã‚’è¨­å®š**
  - ç†ç”±: ç¾åœ¨ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼ˆ`price_test_*_placeholder`ï¼‰
  - æ‰‹é †: Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰å–å¾—ã—ãŸä¾¡æ ¼IDã§`.env`ã‚’æ›´æ–°

### Phase 1.1.2ä»¥é™ã®æ¨å¥¨ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

#### Phase 1.1.2: ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆæ©Ÿèƒ½ï¼ˆ2-3æ—¥ï¼‰
- Stripeãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§å•†å“ãƒ»ä¾¡æ ¼ä½œæˆï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰
- ãƒ—ãƒ©ãƒ³é¸æŠç”»é¢å®Ÿè£…ï¼ˆ`resources/views/subscriptions/select-plan.blade.php`ï¼‰
- Stripe Checkout Sessionçµ±åˆï¼ˆActionãƒ»Serviceãƒ»Responderä½œæˆï¼‰
- æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ç¢ºèªï¼ˆsuccess/cancelãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†ï¼‰

#### Phase 1.1.3: Webhookå‡¦ç†å®Ÿè£…ï¼ˆ1-2æ—¥ï¼‰
- Webhookå—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼ˆä½œæˆãƒ»æ›´æ–°ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰
- ç½²åæ¤œè¨¼ãƒ»ãƒªãƒˆãƒ©ã‚¤å‡¦ç†

#### Phase 1.1.4: ã‚°ãƒ«ãƒ¼ãƒ—ã‚¿ã‚¹ã‚¯åˆ¶é™å®Ÿè£…ï¼ˆ1æ—¥ï¼‰
- ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœˆæ¬¡åˆ¶é™ãƒã‚§ãƒƒã‚¯
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç„¡åˆ¶é™å‡¦ç†
- ã‚«ã‚¦ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆãƒãƒƒãƒå‡¦ç†

#### Phase 1.1.5ä»¥é™
- ãƒ¡ãƒ³ãƒãƒ¼æ•°ä¸Šé™ãƒã‚§ãƒƒã‚¯ï¼ˆPhase 1.1.5ï¼‰
- è¿½åŠ ãƒ¡ãƒ³ãƒãƒ¼èª²é‡‘ï¼ˆPhase 1.1.6ï¼‰
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»å†é–‹å‡¦ç†ï¼ˆPhase 1.1.7ï¼‰
- æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆPhase 1.1.8ï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒ†ã‚¹ãƒˆï¼ˆPhase 1.1.9ï¼‰

---

## æ¤œè¨¼æ–¹æ³•

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼
```bash
# groupsãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
docker exec mtdev-app-1 php artisan tinker --execute="
    \$group = App\Models\Group::first();
    echo 'subscription_active: ' . (\$group->subscription_active ? 'true' : 'false') . PHP_EOL;
    echo 'max_members: ' . \$group->max_members . PHP_EOL;
    echo 'free_group_task_limit: ' . \$group->free_group_task_limit . PHP_EOL;
"

# monthly_reportsãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
docker exec mtdev-app-1 php artisan tinker --execute="
    echo 'monthly_reports table exists: ' . (Schema::hasTable('monthly_reports') ? 'Yes' : 'No') . PHP_EOL;
"
```

### è¨­å®šå€¤ç¢ºèª
```bash
# ãƒ—ãƒ©ãƒ³å®šç¾©ç¢ºèª
docker exec mtdev-app-1 php artisan tinker --execute="
    \$plans = config('const.stripe.subscription_plans');
    echo 'Family plan amount: Â¥' . \$plans['family']['amount'] . PHP_EOL;
    echo 'Enterprise plan amount: Â¥' . \$plans['enterprise']['amount'] . PHP_EOL;
"
```

---

## å‚è€ƒè³‡æ–™

- **è¨ˆç”»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/plans/phase1-1-stripe-subscription-plan.md`
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«**:
  - `database/migrations/2025_11_30_111950_add_subscription_fields_to_groups_table.php`
  - `database/migrations/2025_11_30_112052_create_monthly_reports_table.php`
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `config/const.php` (stripeã‚»ã‚¯ã‚·ãƒ§ãƒ³)
- **ãƒ¢ãƒ‡ãƒ«**: `app/Models/Group.php`, `app/Models/MonthlyReport.php`
- **Laravel Cashier**: https://laravel.com/docs/11.x/billing
- **Stripe API**: https://stripe.com/docs/api

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **è¨ˆç”»æ›¸**: `docs/plans/phase1-1-stripe-subscription-plan.md`
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: 
  - `database/migrations/2025_11_30_111950_add_subscription_fields_to_groups_table.php`
  - `database/migrations/2025_11_30_112052_create_monthly_reports_table.php`
- **ãƒ¢ãƒ‡ãƒ«**:
  - `app/Models/Group.php`
  - `app/Models/MonthlyReport.php`
- **è¨­å®š**: 
  - `config/const.php`
  - `.env`

---

## ğŸ¯ æˆæœã¾ã¨ã‚

Phase 1.1.1ã§ã¯ã€**Stripeèª²é‡‘ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤ã¨ãªã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã¨è¨­å®š**ã‚’å®Œå…¨ã«æ•´å‚™ã—ã¾ã—ãŸã€‚

### ä¸»è¦æˆæœ

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: groupsãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µï¼ˆ9ã‚«ãƒ©ãƒ ï¼‰+ monthly_reportsãƒ†ãƒ¼ãƒ–ãƒ«æ–°è¦ä½œæˆ
2. **è¨­å®š**: ãƒ—ãƒ©ãƒ³å®šç¾©ãƒ»ä¾¡æ ¼è¨­å®šãƒ»ç„¡æ–™æ åˆ¶é™ã‚’ä½“ç³»åŒ–
3. **ãƒ¢ãƒ‡ãƒ«**: Groupãƒ»MonthlyReportãƒ¢ãƒ‡ãƒ«ã®æº–å‚™å®Œäº†
4. **ç’°å¢ƒå¤‰æ•°**: Stripeä¾¡æ ¼IDã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¨­å®šå®Œäº†

### æ¬¡ã®å®Ÿè£…ï¼ˆPhase 1.1.2ï¼‰

**Stripeãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§ã®å•†å“ãƒ»ä¾¡æ ¼ä½œæˆ**ã‹ã‚‰é–‹å§‹ã—ã€ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³é¸æŠç”»é¢ã¨Checkoutçµ±åˆã‚’å®Ÿè£…ã—ã¾ã™ã€‚Stripeå¯©æŸ»ä¸­ã§ã‚‚ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å®Œå…¨ã«é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆãŒå¯èƒ½ã§ã™ã€‚

---

**å®Ÿè£…å®Œäº†æ—¥æ™‚**: 2025å¹´11æœˆ30æ—¥  
**å®Ÿè£…è€…**: GitHub Copilot  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: æœªå®Ÿæ–½
