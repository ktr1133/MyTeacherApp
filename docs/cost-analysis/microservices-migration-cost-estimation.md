# マイクロサービス移行 インフラコスト試算書

## 更新履歴

| バージョン | 日付 | 更新内容 | 更新者 |
|----------|------|---------|--------|
| 1.1.0 | 2025-11-29 | 個人開発向けに修正 - インフラコストのみに特化 | System |
| 1.0.0 | 2025-11-29 | 初版作成 - 各フェーズごとの詳細コスト試算 | System |

---

## 1. インフラコスト試算の前提条件

### 1.1 想定トラフィック・ユーザー数
- **アクティブユーザー**: 月間500ユーザー
- **DAU**: 50ユーザー/日
- **API リクエスト**: 月間100,000リクエスト
- **ストレージ**: 月間50GB (画像・ファイル)
- **DB レコード**: 月間10,000件増加

### 1.2 リージョン・通貨
- **AWSリージョン**: ap-northeast-1 (東京)
- **通貨**: USD (2025年11月時点の料金)
- **計算期間**: 月額ベース

---

## 2. Phase 0: インフラ基盤構築 (完了)

**期間**: 2025年11月 (完了)  
**実装状況**: ✅ 完了

### 2.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **VPC** | プライベートネットワーク | $0.00 |
| **Internet Gateway** | 外部接続 | $0.00 |
| **NAT Gateway** (2AZ) | プライベートサブネット用 | $45.00 × 2 = $90.00 |
| **Application Load Balancer** | 負荷分散 | $22.26 |
| **Route53 (Hosted Zone)** | DNS管理 | $0.50 |
| **ACM SSL証明書** | HTTPS対応 | $0.00 |
| **CloudWatch Logs** | ログ保存 (5GB) | $2.50 |
| **S3 Bucket** | 静的ファイル保存 (50GB) | $1.15 |

**Phase 0 月額コスト**: **$116.41**

### 2.2 移行作業
**個人開発のため開発費用は計上せず、技術的な移行作業のみ実施**

**Phase 0 月額コスト**: **$116.41**

---

## 3. Phase 1: 認証サービス分離 (完了)

**期間**: 2025年11月 (完了)  
**実装状況**: ✅ 完了

### 3.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **Amazon Cognito** | | |
| - ユーザープール | 500 MAU | $0.00 (50,000 MAU まで無料) |
| - アイデンティティプール | フェデレーション | $0.00 |
| **Lambda@Edge** | JWT検証 (100万リクエスト) | $0.60 |
| **CloudWatch** | 認証ログ | $5.00 |

**Phase 1 追加月額コスト**: **$5.60**  
**Phase 1 累計月額コスト**: **$122.01**

### 3.2 技術移行作業
**個人開発のため開発費用は計上せず**
- Cognito設定・ユーザー移行
- 認証フロー統合・テスト

---

## 4. Phase 2: タスクサービス分離 (完了)

**期間**: 2025年11月 (完了)  
**実装状況**: ✅ 完了（Node.js + ECS Fargate）

### 4.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **Amazon ECS** | | |
| - Fargate タスク (0.5 vCPU, 1GB) | 24時間稼働 | $24.48 |
| **Amazon ECR** | Dockerイメージ保存 (10GB) | $1.00 |
| **RDS PostgreSQL** | | |
| - db.t3.micro | 共有インスタンス | $13.92 |
| - ストレージ (20GB) | gp2 | $2.76 |
| - バックアップ (20GB) | 7日間保持 | $2.30 |
| **ElastiCache Redis** | | |
| - cache.t3.micro | セッション・キャッシュ | $12.41 |
| **API Gateway** | Task API (100万リクエスト) | $3.50 |
| **CloudWatch** | ECS・Task Service監視 | $8.00 |

**Phase 2 追加月額コスト**: **$68.37**  
**Phase 2 累計月額コスト**: **$190.38**

### 4.2 技術移行作業
**個人開発のため開発費用は計上せず**
- Node.js Task Service実装
- データ移行・ECS設定・CI/CD構築
- テスト・性能調整

---

## 5. Phase 3: AI サービス分離 (予定)

**期間**: 2025年12月2日〜16日 (予定)  
**実装状況**: 🔄 計画中

### 5.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **Lambda (AI Service)** | | |
| - OpenAI API呼び出し (100万リクエスト) | タスク分解・提案 | $0.20 |
| - DALL-E API呼び出し (1万リクエスト) | アバター生成 | $2.00 |
| - Stable Diffusion (1万リクエスト) | アバター生成 | $2.00 |
| **DynamoDB** | | |
| - テーブル (1GB, 100 RCU/WCU) | AI使用履歴 | $3.50 |
| **SQS** | | |
| - 標準キュー (100万リクエスト) | 非同期AI処理 | $0.40 |
| **S3** | | |
| - 追加ストレージ (20GB) | 生成画像保存 | $0.46 |
| **CloudWatch** | AI Service監視 | $3.00 |

**Phase 3 追加月額コスト**: **$11.56**  
**Phase 3 累計月額コスト**: **$201.94**

### 5.2 外部API費用 (重要)

| API サービス | 使用量 (月間) | 単価 | 月額コスト (USD) |
|-------------|-------------|------|----------------|
| **OpenAI GPT-4o-mini** | | | |
| - 入力トークン | 500万トークン | $0.150/1M | $0.75 |
| - 出力トークン | 150万トークン | $0.600/1M | $0.90 |
| **OpenAI DALL-E 3** | | | |
| - 標準品質 1024×1024 | 200画像 | $0.040/画像 | $8.00 |
| **Replicate Stable Diffusion** | | | |
| - Anything-v4.0 | 500画像 | $0.01/画像 | $5.00 |
| - Animagine-XL-3.1 | 200画像 | $0.004/画像 | $0.80 |
| - SD 3.5 Medium | 100画像 | $0.035/画像 | $3.50 |

**Phase 3 外部API費用**: **$18.95**  
**Phase 3 総月額コスト**: **$220.89**

### 5.3 技術実装作業
**個人開発のため開発費用は計上せず**
- Lambda AI Service実装
- OpenAI・Stable Diffusion統合
- DynamoDB設計・API Gateway統合

---

## 6. Phase 4: 通知・トークンサービス分離 (予定)

**期間**: 2025年12月16日〜2026年1月13日 (予定)  
**実装状況**: 📋 計画中

### 6.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **Lambda (通知サービス)** | | |
| - 通知処理 (50万リクエスト) | メール・プッシュ通知 | $0.10 |
| **Lambda (トークンサービス)** | | |
| - 決済・残高処理 (50万リクエスト) | トークン管理 | $0.10 |
| **SES** | | |
| - メール送信 (10,000通/月) | システム通知 | $1.00 |
| **SNS** | | |
| - プッシュ通知 (100,000通/月) | モバイル通知 | $0.50 |
| **EventBridge** | | |
| - カスタムイベント (100万イベント) | サービス間連携 | $1.00 |
| **DynamoDB追加** | | |
| - 通知履歴テーブル (2GB) | 通知履歴保存 | $0.50 |
| - トークン履歴テーブル (1GB) | 決済履歴保存 | $0.25 |

**Phase 4 追加月額コスト**: **$3.45**  
**Phase 4 累計月額コスト**: **$224.34**

### 6.2 外部サービス費用

| サービス | 使用量・プラン | 月額コスト (USD) |
|---------|-------------|----------------|
| **Stripe決済** | 取引手数料 3.6% | 変動費 |
| **Twilio (SMS)** | 1,000通/月 | $7.50 |

**Phase 4 外部サービス費用**: **$7.50** (+ Stripe手数料)  
**Phase 4 総月額コスト**: **$231.84**

### 6.3 技術実装作業
**個人開発のため開発費用は計上せず**
- 通知・トークンサービス実装
- Stripe統合改修・SES/SNS設定
- イベント駆動設計実装

---

## 7. Phase 5: 最終モノリス分解 (予定)

**期間**: 2026年1月13日〜2月3日 (予定)  
**実装状況**: 📋 計画中

### 7.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **Lambda (ユーザーサービス)** | | |
| - ユーザー管理 (50万リクエスト) | プロフィール・設定 | $0.10 |
| **Lambda (レポートサービス)** | | |
| - レポート生成 (10万リクエスト) | 実績・統計 | $0.02 |
| **Lambda (管理サービス)** | | |
| - 管理機能 (5万リクエスト) | バックオフィス | $0.01 |
| **CloudFront** | | |
| - CDN配信 (1TB/月) | 静的ファイル配信 | $8.50 |
| **WAF** | | |
| - 基本保護ルール | セキュリティ | $1.00 |

**Phase 5 追加月額コスト**: **$9.63**  
**Phase 5 累計月額コスト**: **$241.47**

### 7.2 技術実装作業
**個人開発のため開発費用は計上せず**
- ユーザー・レポート・管理サービス実装
- API Gateway統合完了
- モノリス削除・最終移行

---

## 8. ポータルサイト独立化 (Phase 3以降並行)

**期間**: Phase 3開始以降に並行実装  
**実装状況**: 📋 計画中

### 8.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **S3 + CloudFront** | | |
| - 静的ホスティング (100GB) | ポータルサイト本体 | $2.30 |
| - CloudFront配信 (500GB) | 高速配信 | $4.25 |
| **Lambda (ポータルCMS)** | | |
| - CMS API (10万リクエスト) | FAQ・お問い合わせ管理 | $0.02 |
| **DynamoDB** | | |
| - FAQ・お問い合わせデータ (500MB) | コンテンツ保存 | $0.13 |
| **SES** | | |
| - お問い合わせメール (1,000通) | 自動返信・通知 | $0.10 |

**ポータル追加月額コスト**: **$6.80**

### 8.2 技術実装作業
**個人開発のため開発費用は計上せず**
- 静的サイト生成・CMS API開発
- お問い合わせフォーム・管理画面構築

---

## 9. モバイルアプリ対応 (Phase 3完了後)

**期間**: 2025年12月16日〜2026年2月末 (予定)  
**実装状況**: 📋 計画中

### 9.1 AWS リソース

| サービス | 設定・用途 | 月額コスト (USD) |
|---------|-----------|-----------------|
| **API Gateway** | | |
| - 追加API (200万リクエスト) | モバイル専用エンドポイント | $7.00 |
| **SNS** | | |
| - プッシュ通知 (50万通) | iOS・Android通知 | $2.50 |
| **CloudFront** | | |
| - API配信 (1TB) | モバイルAPI高速化 | $8.50 |
| **CodeDeploy** | | |
| - アプリ配信 | OTA更新 | $0.02 |

**モバイルアプリ追加月額コスト**: **$18.02**

### 9.2 技術実装作業
**個人開発のため開発費用は計上せず**
- React Native基盤構築・API連携実装
- プッシュ通知・アプリストア公開対応

---

## 10. インフラコスト集計

### 10.1 月額運用コスト推移

| フェーズ | 期間 | AWS月額 (USD) | 外部API (USD) | 総月額 (USD) |
|---------|------|-------------|-------------|-------------|
| **現在 (モノリス)** | - | $50.00 | $15.00 | $65.00 |
| **Phase 0** | 2025年11月 | $116.41 | $15.00 | $131.41 |
| **Phase 1** | 2025年11月 | $122.01 | $15.00 | $137.01 |
| **Phase 2** | 2025年11月 | $190.38 | $15.00 | $205.38 |
| **Phase 3** | 2025年12月〜 | $201.94 | $33.95 | $235.89 |
| **Phase 4** | 2026年1月〜 | $224.34 | $41.45 | $265.79 |
| **Phase 5** | 2026年2月〜 | $241.47 | $41.45 | $282.92 |
| **+ ポータル** | 2026年3月〜 | $248.27 | $41.45 | $289.72 |
| **+ モバイル** | 2026年4月〜 | $266.29 | $41.45 | $307.74 |

### 10.2 年間コスト比較 (完全移行後)

| 項目 | 現在 (モノリス) | 移行後 (マイクロサービス) | 差額 |
|------|---------------|---------------------|------|
| **月額運用費** | $65.00 | $307.74 | +$242.74 |
| **年額運用費** | $780.00 | $3,692.88 | +$2,912.88 |
| **スケーラビリティ** | 低 | 高 | 大幅向上 |
| **可用性** | 低 (単一障害点) | 高 (冗長化) | 大幅向上 |
| **開発効率** | 低 (密結合) | 高 (独立開発) | 大幅向上 |

---

## 11. コスト最適化提案

### 11.1 短期施策 (3ヶ月以内)

| 施策 | 削減効果 (月額USD) | 実装難易度 |
|------|------------------|-----------|
| **Reserved Instances** | -$30.00 | 低 |
| **Spot Instances (開発環境)** | -$15.00 | 低 |
| **S3 Intelligent-Tiering** | -$5.00 | 低 |
| **CloudWatch Logs圧縮** | -$3.00 | 中 |

**短期削減効果**: **-$53.00/月** (-$636.00/年)

### 11.2 中期施策 (6ヶ月以内)

| 施策 | 削減効果 (月額USD) | 実装難易度 |
|------|------------------|-----------|
| **API Gateway → ALB移行** | -$20.00 | 中 |
| **Lambda → ECS移行 (適用箇所)** | -$25.00 | 中 |
| **DynamoDB On-Demand → Provisioned** | -$10.00 | 低 |
| **外部API使用量最適化** | -$15.00 | 高 |

**中期削減効果**: **-$70.00/月** (-$840.00/年)

### 11.3 長期施策 (12ヶ月以内)

| 施策 | 削減効果 (月額USD) | 実装難易度 |
|------|------------------|-----------|
| **Multi-AZ → Single-AZ (開発)** | -$45.00 | 低 |
| **CDN最適化** | -$10.00 | 中 |
| **自動スケーリング精緻化** | -$20.00 | 高 |

**長期削減効果**: **-$75.00/月** (-$900.00/年)

### 11.4 最適化後の予想コスト

| 期間 | 最適化前 (USD) | 最適化後 (USD) | 削減率 |
|------|-------------|-------------|--------|
| **月額** | $307.74 | $109.74 | **64.3%** |
| **年額** | $3,692.88 | $1,316.88 | **64.3%** |

### 11.5 削減効果の詳細内訳

#### 💰 Reserved Instances効果 (-$30.00/月)
- **RDS PostgreSQL**: $13.92 → $8.50 (-39%)
- **ElastiCache Redis**: $12.41 → $7.60 (-39%) 
- **ECS Fargate**: $24.48 → $17.64 (-28%)
- **NAT Gateway**: $90.00 → $77.00 (-14%)

#### 🏗️ アーキテクチャ最適化 (-$85.00/月)
- **API Gateway → ALB**: -$20.00 (リクエスト単価削減)
- **Lambda → ECS**: -$25.00 (コールドスタート排除)
- **Multi-AZ → Single-AZ** (開発環境): -$45.00 (冗長化削除)

#### 📊 リソース効率化 (-$38.00/月)
- **DynamoDB**: -$10.00 (On-Demand → Provisioned)
- **S3**: -$5.00 (Intelligent-Tiering)
- **CloudWatch Logs**: -$3.00 (圧縮・保存期間短縮)
- **自動スケーリング**: -$20.00 (適正サイジング)

#### 🌐 外部サービス最適化 (-$45.00/月)
- **OpenAI API**: -$0.65 (キャッシュ導入)
- **DALL-E 3**: -$3.00 (生成頻度制限)
- **Stable Diffusion**: -$3.30 (軽量モデル併用)
- **Twilio SMS**: -$3.50 (メール優先)
- **CDN**: -$10.00 (キャッシュ最適化)
- **開発環境Spot**: -$15.00 (スポットインスタンス)
- **その他API**: -$9.55 (不要サービス削除)
| **年額** | $3,692.88 | $1,316.88 | **64.3%** |

---

## 12. 個人開発向け 運用効率分析

### 12.1 インフラ管理の負荷軽減効果

| 項目 | モノリス | マイクロサービス | 効果 |
|------|--------|---------------|------|
| **障害対応時間** | 2-4時間 | 30分-1時間 | 大幅短縮 |
| **デプロイ作業** | 30分（全停止） | 5分（無停止） | 効率化 |
| **スケールアップ** | 全サーバー交換 | 該当サービスのみ | コスト効率 |
| **新機能追加** | 全システム影響 | 独立開発 | リスク軽減 |

### 12.2 技術的メリット

- **独立性**: 各サービスを個別にアップデート可能
- **技術選択**: サービスごとに最適な技術スタック選択
- **学習価値**: 最新のクラウドネイティブ技術習得
- **ポートフォリオ**: 企業レベルのアーキテクチャ実装経験

---

## 13. 推奨実装戦略（個人開発向け）

### 13.1 段階的移行アプローチ

1. **Phase 3 (AI Service)** - 最も効果的な分離ポイント
2. **コスト最適化施策** - Reserved Instances等の導入
3. **Phase 4 (通知・トークン)** - 安定性・独立性向上
4. **ポータルサイト独立** - リスク分散効果
5. **モバイルアプリ** - 事業拡大への投資

### 13.2 予算管理提案

| 期間 | フェーズ | 月額予算 (USD) | 累積月額 (USD) |
|------|---------|-------------|-------------|
| **2025年12月** | Phase 3 | +$30.51 | $235.89 |
| **2026年1月** | Phase 4 | +$29.85 | $265.79 |
| **2026年2月** | Phase 5 + ポータル | +$23.93 | $289.72 |
| **2026年3月〜** | 最適化施策導入 | -$198.00 | $109.74 |

### 13.3 個人開発者向け注意点

- **初期コスト上昇**: 移行期間中は現行システムと並行運用
- **学習コスト**: 新技術習得に時間投資が必要
- **監視体制**: CloudWatch等での適切なモニタリング設定
- **セキュリティ**: IAMロール・VPC設定の適切な管理

---

## 14. まとめ

### 14.1 重要なポイント

1. **段階的投資**: 一度に大きなコスト増加をせず、フェーズごとに価値を確認
2. **コスト最適化**: Reserved Instances等で最終的に64%のコスト削減可能
3. **技術的価値**: 最新クラウド技術の習得・ポートフォリオ価値向上
4. **リスク分散**: モノリス障害による全サービス停止リスクを解消

### 14.2 インフラコスト サマリー

- **現在**: $65.00/月
- **完全移行後**: $307.74/月
- **最適化後**: $109.74/月 (現在比+69%)
- **年間コスト差**: +$536.88 (最適化後)

### 14.3 次のアクション

- [ ] Phase 3実装開始検討 (月額+$30.51)
- [ ] AWS Reserved Instances購入検討 (月額-$30削減)
- [ ] 外部API使用量モニタリング開始
- [ ] コスト最適化施策の段階的導入計画

---

**作成日**: 2025年11月29日  
**最終更新**: 2025年11月29日（個人開発向けに修正）