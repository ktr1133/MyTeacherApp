document.addEventListener("DOMContentLoaded",function(){const r=document.getElementById("enterprise-plan-btn"),a=document.getElementById("enterprise-modal"),c=document.getElementById("modal-overlay"),m=document.getElementById("close-modal"),u=document.getElementById("cancel-modal"),o=document.getElementById("additional_members"),y=document.getElementById("total-price"),s=document.getElementById("confirm-enterprise"),E=3e3,g=150;function I(){a.classList.remove("hidden"),a.classList.add("flex"),document.body.style.overflow="hidden",l()}function i(){a.classList.add("hidden"),a.classList.remove("flex"),document.body.style.overflow="",o.value="0",l()}function l(){const e=parseInt(o.value)||0,t=Math.max(0,Math.min(100,e));e!==t&&(o.value=t);const n=E+t*g;y.textContent=n.toLocaleString("ja-JP"),t>0?s.textContent=`¥${n.toLocaleString("ja-JP")}/月で申し込む`:s.textContent="¥3,000/月で申し込む"}function h(){const e=document.getElementById("enterprise-form"),t=document.createElement("input");t.type="hidden",t.name="additional_members",t.value=o.value||"0",e.appendChild(t);const n=document.createElement("input");n.type="hidden",n.name="plan",n.value="enterprise",e.appendChild(n),e.submit()}r&&r.addEventListener("click",I),m&&m.addEventListener("click",i),u&&u.addEventListener("click",i),c&&c.addEventListener("click",function(e){e.target===c&&i()}),o&&(o.addEventListener("input",l),o.addEventListener("keypress",function(e){(e.key<"0"||e.key>"9")&&e.preventDefault()})),s&&s.addEventListener("click",h),document.addEventListener("keydown",function(e){e.key==="Escape"&&!a.classList.contains("hidden")&&i()});const f=document.getElementById("family-plan-btn");f&&f.addEventListener("click",function(){const e=document.getElementById("family-form"),t=document.createElement("input");t.type="hidden",t.name="plan",t.value="family",e.appendChild(t),e.submit()});const d=document.querySelectorAll(".plan-card");d.forEach(e=>{e.addEventListener("mouseenter",function(){d.forEach(t=>{t!==e&&(t.style.transform="scale(0.97)",t.style.opacity="0.8")})}),e.addEventListener("mouseleave",function(){d.forEach(t=>{t.style.transform="",t.style.opacity=""})})});const L={threshold:.1,rootMargin:"0px 0px -100px 0px"},p=new IntersectionObserver(function(e){e.forEach((t,n)=>{t.isIntersecting&&(setTimeout(()=>{t.target.style.opacity="1",t.target.style.transform="translateY(0)"},n*100),p.unobserve(t.target))})},L);d.forEach(e=>{e.style.opacity="0",e.style.transform="translateY(30px)",e.style.transition="opacity 0.6s ease, transform 0.6s ease",p.observe(e)}),o&&o.addEventListener("blur",function(){const e=parseInt(this.value)||0;e<0?(this.value="0",v("追加メンバー数は0以上を指定してください。")):e>100&&(this.value="100",v("追加メンバー数は100名までです。")),l()});function v(e){const t=document.getElementById("validation-message");t&&t.remove();const n=document.createElement("div");n.id="validation-message",n.className="mt-2 text-sm text-red-600 dark:text-red-400",n.textContent=e,o.parentNode.appendChild(n),setTimeout(()=>{n.remove()},3e3)}});
