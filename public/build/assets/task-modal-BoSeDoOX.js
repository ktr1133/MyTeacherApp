class o{constructor(t){this.taskId=t,this.modal=null,this.overlay=null,this.form=null,this.isOpen=!1,this.fields={title:null,description:null,span:null,dueDate:null,selectedTags:[]},this.init()}init(){this.modal=document.querySelector(`[data-task-modal="${this.taskId}"]`),this.modal&&(this.overlay=this.modal.querySelector("[data-modal-overlay]"),this.content=this.modal.querySelector("[data-modal-content]"),this.form=this.modal.querySelector("form"),this.fields.title=this.form.querySelector('[name="title"]'),this.fields.description=this.form.querySelector('[name="description"]'),this.fields.span=this.form.querySelector('[name="span"]'),this.setupEventListeners(),this.setupSpanHandling(),this.setupTagHandling())}setupEventListeners(){this.modal.querySelectorAll("[data-close-modal]").forEach(s=>{s.addEventListener("click",()=>this.close())}),this.overlay&&this.overlay.addEventListener("click",s=>{s.target===this.overlay&&this.close()}),document.addEventListener("keydown",s=>{s.key==="Escape"&&this.isOpen&&this.close()});const e=this.modal.querySelector("[data-submit-form]");e&&e.addEventListener("click",()=>this.submit())}setupSpanHandling(){if(!this.fields.span)return;const t={short:this.modal.querySelector("[data-due-date-short]"),mid:this.modal.querySelector("[data-due-date-mid]"),long:this.modal.querySelector("[data-due-date-long]")},e=()=>{const s=parseInt(this.fields.span.value);Object.values(t).forEach(a=>{a&&a.classList.add("hidden")}),s===1&&t.short?t.short.classList.remove("hidden"):s===2&&t.mid?t.mid.classList.remove("hidden"):s===3&&t.long&&t.long.classList.remove("hidden")};this.fields.span.addEventListener("change",e),e()}setupTagHandling(){this.form.querySelectorAll('input[name="tags[]"]').forEach(e=>{const s=e.closest(".tag-chip");s&&(this.updateTagUI(e,s),e.addEventListener("change",()=>{this.updateTagUI(e,s)}))})}updateTagUI(t,e){t.checked?(e.classList.add("bg-gradient-to-r","from-[#59B9C6]","to-purple-600","text-white"),e.classList.remove("bg-gray-100","dark:bg-gray-700","text-gray-700","dark:text-gray-300")):(e.classList.remove("bg-gradient-to-r","from-[#59B9C6]","to-purple-600","text-white"),e.classList.add("bg-gray-100","dark:bg-gray-700","text-gray-700","dark:text-gray-300"))}open(){this.modal&&(this.isOpen=!0,this.modal.classList.remove("hidden"),this.overlay?.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),requestAnimationFrame(()=>{this.overlay?.classList.add("opacity-100"),this.overlay?.classList.remove("opacity-0"),this.content?.classList.add("opacity-100","scale-100"),this.content?.classList.remove("opacity-0","scale-95")}),this.fields.title&&setTimeout(()=>this.fields.title.focus(),100))}close(){this.modal&&(this.overlay?.classList.add("opacity-0"),this.overlay?.classList.remove("opacity-100"),this.content?.classList.add("opacity-0","scale-95"),this.content?.classList.remove("opacity-100","scale-100"),setTimeout(()=>{this.modal.classList.add("hidden"),this.overlay?.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),this.isOpen=!1},200))}submit(){if(this.form){if(!this.fields.title?.value.trim()){window.showAlertDialog?window.showAlertDialog("タスク名を入力してください"):alert("タスク名を入力してください"),this.fields.title?.focus();return}this.form.submit()}}}window.TaskModalController={instances:new Map,register(i){return this.instances.has(i)||this.instances.set(i,new o(i)),this.instances.get(i)},open(i){this.register(i).open()},close(i){const t=this.instances.get(i);t&&t.close()}};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-task-modal]").forEach(t=>{const e=t.dataset.taskModal;e&&window.TaskModalController.register(parseInt(e))})});
