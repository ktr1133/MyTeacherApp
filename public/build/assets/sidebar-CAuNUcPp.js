class n{constructor(){this.isCollapsed=this.loadState("sidebar-collapsed",!1),this.isMobileOpen=!1,this.showGeneralMenu=!0,this.portalExpanded=this.loadState("sidebar-portal-expanded",!1),this.portalExpandedMobile=this.loadState("sidebar-portal-expanded-mobile",!1),this.desktopSidebar=null,this.mobileSidebar=null,this.mobileOverlay=null,this.isAdmin=!1,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}init(){this.desktopSidebar=document.querySelector('[data-sidebar="desktop"]'),this.mobileSidebar=document.querySelector('[data-sidebar="mobile"]'),this.mobileOverlay=document.querySelector('[data-sidebar-overlay="mobile"]'),this.isAdmin=this.desktopSidebar?.getAttribute("data-is-admin")==="true",this.isAdmin?this.showGeneralMenu=this.loadState("sidebar-general-menu",!0):this.showGeneralMenu=!0,console.log("[Sidebar] DOM elements found:",{desktopSidebar:!!this.desktopSidebar,mobileSidebar:!!this.mobileSidebar,mobileOverlay:!!this.mobileOverlay,isAdmin:this.isAdmin,showGeneralMenu:this.showGeneralMenu}),this.desktopSidebar&&this.applyDesktopState(),this.applyGeneralMenuState(),this.applyPortalState(),this.setupEventListeners()}loadState(t,i){try{const a=localStorage.getItem(t);return a===null?i:a==="true"}catch(a){return console.warn(`[Sidebar] Failed to load state from localStorage (${t}):`,a),i}}saveState(t,i){try{localStorage.setItem(t,i.toString())}catch(a){console.warn(`[Sidebar] Failed to save state to localStorage (${t}):`,a)}}applyDesktopState(){if(!this.desktopSidebar)return;this.isCollapsed?(this.desktopSidebar.classList.add("collapsed"),this.desktopSidebar.classList.remove("gap-3","px-3","py-2"),this.desktopSidebar.classList.add("justify-center","p-3")):(this.desktopSidebar.classList.remove("collapsed"),this.desktopSidebar.classList.add("gap-3","px-3","py-2"),this.desktopSidebar.classList.remove("justify-center","p-3")),this.desktopSidebar.querySelectorAll('[data-show-when="expanded"]').forEach(o=>{o.style.display=this.isCollapsed?"none":""}),this.desktopSidebar.querySelectorAll('[data-show-when="collapsed"]').forEach(o=>{o.style.display=this.isCollapsed?"":"none"});const a=this.desktopSidebar.querySelector('[data-icon="expand"]'),s=this.desktopSidebar.querySelector('[data-icon="collapse"]');a&&(a.style.display=this.isCollapsed?"":"none"),s&&(s.style.display=this.isCollapsed?"none":"");const l=this.desktopSidebar.querySelector('[data-sidebar-action="toggle-desktop"]');l&&(l.setAttribute("aria-expanded",(!this.isCollapsed).toString()),l.setAttribute("aria-label",this.isCollapsed?"サイドバーを展開":"サイドバーを最小化"))}applyGeneralMenuState(){if(this.desktopSidebar){const t=this.desktopSidebar.querySelector("[data-general-menu]");if(t&&(this.isAdmin?t.style.display=this.showGeneralMenu?"":"none":t.style.display=""),this.isAdmin){const i=this.desktopSidebar.querySelector('[data-icon="general-show"]'),a=this.desktopSidebar.querySelector('[data-icon="general-hide"]');i&&(i.style.display=this.showGeneralMenu?"":"none"),a&&(a.style.display=this.showGeneralMenu?"none":"");const s=this.desktopSidebar.querySelector('[data-action="toggle-general-menu"]');s&&s.setAttribute("aria-label",this.showGeneralMenu?"一般メニューを非表示":"一般メニューを表示")}}if(this.mobileSidebar){const t=this.mobileSidebar.querySelector("[data-general-menu-mobile]");if(t&&(this.isAdmin?t.style.display=this.showGeneralMenu?"":"none":t.style.display=""),this.isAdmin){const i=this.mobileSidebar.querySelector('[data-icon="general-show-mobile"]'),a=this.mobileSidebar.querySelector('[data-icon="general-hide-mobile"]');i&&(i.style.display=this.showGeneralMenu?"":"none"),a&&(a.style.display=this.showGeneralMenu?"none":"");const s=this.mobileSidebar.querySelector('[data-action="toggle-general-menu-mobile"]');s&&s.setAttribute("aria-label",this.showGeneralMenu?"一般メニューを非表示":"一般メニューを表示")}}}applyPortalState(){if(this.desktopSidebar){const t=this.desktopSidebar.querySelector("[data-portal-submenu]");t&&(t.style.display=this.portalExpanded?"":"none");const i=this.desktopSidebar.querySelector("[data-portal-icon]");i&&i.classList.toggle("rotate-180",this.portalExpanded)}if(this.mobileSidebar){const t=this.mobileSidebar.querySelector("[data-portal-submenu-mobile]");t&&(t.style.display=this.portalExpandedMobile?"":"none");const i=this.mobileSidebar.querySelector("[data-portal-icon-mobile]");i&&i.classList.toggle("rotate-180",this.portalExpandedMobile)}}toggleDesktop(){this.isCollapsed=!this.isCollapsed,this.saveState("sidebar-collapsed",this.isCollapsed),this.applyDesktopState()}toggleGeneralMenu(){this.showGeneralMenu=!this.showGeneralMenu,this.saveState("sidebar-general-menu",this.showGeneralMenu),this.applyGeneralMenuState()}togglePortal(){this.portalExpanded=!this.portalExpanded,this.saveState("sidebar-portal-expanded",this.portalExpanded),this.applyPortalState()}togglePortalMobile(){this.portalExpandedMobile=!this.portalExpandedMobile,this.saveState("sidebar-portal-expanded-mobile",this.portalExpandedMobile),this.applyPortalState()}openMobile(){if(!this.mobileSidebar||!this.mobileOverlay){console.warn("[Sidebar] Mobile sidebar or overlay not found");return}this.isMobileOpen=!0,this.mobileOverlay.classList.remove("hidden"),this.mobileSidebar.classList.remove("hidden"),this.mobileOverlay.classList.remove("opacity-100"),this.mobileOverlay.classList.add("opacity-0"),this.mobileSidebar.classList.add("-translate-x-full"),this.mobileSidebar.classList.remove("translate-x-0"),requestAnimationFrame(()=>{this.mobileOverlay.classList.remove("opacity-0"),this.mobileOverlay.classList.add("opacity-100"),this.mobileSidebar.classList.remove("-translate-x-full"),this.mobileSidebar.classList.add("translate-x-0"),this.applyGeneralMenuState(),this.applyPortalState()}),document.body.style.overflow="hidden",console.log("[Sidebar] Mobile sidebar opened")}closeMobile(){if(!this.mobileSidebar||!this.mobileOverlay){console.warn("[Sidebar] Mobile sidebar or overlay not found");return}this.isMobileOpen=!1,this.mobileOverlay.classList.remove("opacity-100"),this.mobileOverlay.classList.add("opacity-0"),this.mobileSidebar.classList.add("-translate-x-full"),this.mobileSidebar.classList.remove("translate-x-0"),setTimeout(()=>{this.mobileOverlay.classList.add("hidden"),this.mobileSidebar.classList.add("hidden")},300),document.body.style.overflow="",console.log("[Sidebar] Mobile sidebar closed")}setupEventListeners(){const t=this.desktopSidebar?.querySelector('[data-sidebar-action="toggle-desktop"]');t&&t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggleDesktop()});const i=this.desktopSidebar?.querySelector('[data-action="toggle-general-menu"]');i&&i.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggleGeneralMenu()});const a=this.desktopSidebar?.querySelector('[data-action="toggle-portal"]');a&&a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.togglePortal()});const s=this.mobileSidebar?.querySelector('[data-action="toggle-general-menu-mobile"]');s&&s.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.toggleGeneralMenu()});const l=this.mobileSidebar?.querySelector('[data-action="toggle-portal-mobile"]');l&&l.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.togglePortalMobile()}),this.mobileOverlay&&(this.mobileOverlay.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.closeMobile()}),this.mobileOverlay.addEventListener("touchstart",e=>{e.preventDefault(),e.stopPropagation(),this.closeMobile()},{passive:!1}));const o=this.mobileSidebar?.querySelector('[data-action="close-mobile"]');o&&(o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.closeMobile()}),o.addEventListener("touchstart",e=>{e.preventDefault(),e.stopPropagation(),this.closeMobile()},{passive:!1}));const r=this.mobileSidebar?.querySelectorAll("[data-close-on-click]");r&&(r.forEach(e=>{e.addEventListener("click",()=>{setTimeout(()=>this.closeMobile(),100)})}),console.log(`[Sidebar] Mobile link listeners added: ${r.length} links`)),document.addEventListener("click",e=>{e.target.closest('[data-sidebar-toggle="mobile"]')&&(e.preventDefault(),e.stopPropagation(),console.log("[Sidebar] Hamburger button clicked"),this.openMobile())}),document.addEventListener("touchstart",e=>{e.target.closest('[data-sidebar-toggle="mobile"]')&&(e.preventDefault(),e.stopPropagation(),this.openMobile())},{passive:!1}),console.log("[Sidebar] Event listeners setup completed")}}window.SidebarController=n;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.sidebarController=new n}):window.sidebarController=new n;
