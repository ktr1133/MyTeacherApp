class c{constructor(t){this.tagId=t,this.modal=null,this.overlay=null,this.content=null,this.isOpen=!1,this.spanFilter="all",this.allTasks=[],this.init()}init(){if(this.modal=document.querySelector(`[data-tag-tasks-modal="${this.tagId}"]`),!this.modal)return;this.overlay=this.modal.querySelector("[data-modal-overlay]"),this.content=this.modal.querySelector("[data-modal-content]");const t=this.modal.dataset.tasks;if(t)try{this.allTasks=JSON.parse(t)}catch(s){console.error("Failed to parse tasks data:",s),this.allTasks=[]}this.setupEventListeners(),this.updateTaskCount()}setupEventListeners(){const t=this.modal.querySelector("[data-close-modal]");t&&t.addEventListener("click",()=>this.close()),this.overlay&&this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen&&this.close()}),this.modal.querySelectorAll("[data-span-filter]").forEach(e=>{e.addEventListener("click",()=>{this.setSpanFilter(e.dataset.spanFilter)})})}setSpanFilter(t){this.spanFilter=t,this.modal.querySelectorAll("[data-span-filter]").forEach(e=>{const i=e.dataset.spanFilter===t;e.setAttribute("aria-pressed",i),i?(e.classList.add("tag-modal-filter-active"),e.classList.remove("tag-modal-filter-inactive")):(e.classList.remove("tag-modal-filter-active"),e.classList.add("tag-modal-filter-inactive"))}),this.filterTasks(),this.updateTaskCount()}filterTasks(){this.modal.querySelectorAll("[data-task-card]").forEach(s=>{const e=s.dataset.taskSpan;this.spanFilter==="all"||e===this.spanFilter?(s.classList.remove("hidden"),s.style.opacity="0",s.style.transform="scale(0.95)",requestAnimationFrame(()=>{s.style.transition="opacity 200ms, transform 200ms",s.style.opacity="1",s.style.transform="scale(1)"})):s.classList.add("hidden")})}updateTaskCount(){const t=this.modal.querySelector("[data-task-count]");if(!t)return;const s=this.getFilteredTasksCount();t.textContent=s,this.modal.querySelectorAll("[data-span-filter]").forEach(i=>{const o=i.querySelector("[data-filter-count]");if(!o)return;const n=i.dataset.spanFilter;let l;n==="all"?l=this.allTasks.length:l=this.allTasks.filter(r=>r.span==n).length,o.textContent=`(${l})`})}getFilteredTasksCount(){return this.spanFilter==="all"?this.allTasks.length:this.allTasks.filter(t=>t.span==this.spanFilter).length}open(){this.modal&&(this.isOpen=!0,this.modal.classList.remove("hidden"),this.overlay&&(this.overlay.style.display="flex"),document.body.classList.add("overflow-hidden"),this.setSpanFilter("all"),requestAnimationFrame(()=>{this.overlay?.classList.add("opacity-100"),this.overlay?.classList.remove("opacity-0"),this.content?.classList.add("opacity-100","scale-100"),this.content?.classList.remove("opacity-0","scale-95")}))}close(){this.modal&&(this.overlay?.classList.add("opacity-0"),this.overlay?.classList.remove("opacity-100"),this.content?.classList.add("opacity-0","scale-95"),this.content?.classList.remove("opacity-100","scale-100"),setTimeout(()=>{this.modal.classList.add("hidden"),this.overlay&&(this.overlay.style.display="none"),document.body.classList.remove("overflow-hidden"),this.isOpen=!1},200))}}window.TagTasksModalController={instances:new Map,register(a){return this.instances.has(a)||this.instances.set(a,new c(a)),this.instances.get(a)},open(a){this.register(a).open()},close(a){const t=this.instances.get(a);t&&t.close()}};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-tag-tasks-modal]").forEach(t=>{const s=t.dataset.tagTasksModal;s&&window.TagTasksModalController.register(parseInt(s))})});
