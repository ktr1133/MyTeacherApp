class n{constructor(t){this.taskId=t,this.modal=null,this.overlay=null,this.content=null,this.isOpen=!1,this.descriptionTextarea=null,this.description="",this.originalDescription="",this.isDirty=!1,this.isSubmitting=!1,this.init()}init(){this.modal=document.querySelector(`[data-approval-modal="${this.taskId}"]`),this.modal&&(this.overlay=this.modal.querySelector("[data-modal-overlay]"),this.content=this.modal.querySelector("[data-modal-content]"),this.descriptionTextarea=this.modal.querySelector("[data-description-field]"),this.saveForm=this.modal.querySelector("[data-save-form]"),this.descriptionTextarea&&(this.originalDescription=this.descriptionTextarea.value,this.description=this.originalDescription),this.setupEventListeners())}setupEventListeners(){this.modal.querySelectorAll("[data-close-modal]").forEach(s=>{s.addEventListener("click",()=>this.close())}),this.overlay&&this.overlay.addEventListener("click",s=>{s.target===this.overlay&&this.close()}),document.addEventListener("keydown",s=>{s.key==="Escape"&&this.isOpen&&this.close()}),this.descriptionTextarea&&this.descriptionTextarea.addEventListener("input",()=>{this.description=this.descriptionTextarea.value,this.isDirty=this.description!==this.originalDescription,this.updateUI()});const e=this.modal.querySelector("[data-save-btn]");e&&e.addEventListener("click",()=>this.save()),this.saveForm&&this.saveForm.addEventListener("submit",()=>{this.isSubmitting=!0,this.updateUI()})}updateUI(){const t=this.modal.querySelector("[data-dirty-indicator]");t&&(this.isDirty?t.classList.remove("hidden"):t.classList.add("hidden"));const e=this.modal.querySelector("[data-char-count]");if(e){const r=this.description?this.description.length:0;e.textContent=`${r}/500文字`}const s=this.modal.querySelector("[data-save-btn]");s&&(s.disabled=!this.isDirty||this.isSubmitting,!this.isDirty||this.isSubmitting?(s.classList.add("opacity-50","cursor-not-allowed"),s.classList.remove("approval-btn-save")):(s.classList.remove("opacity-50","cursor-not-allowed"),s.classList.add("approval-btn-save")));const a=this.modal.querySelector("[data-save-btn-text]"),o=this.modal.querySelector("[data-saving-text]");a&&o&&(this.isSubmitting?(a.classList.add("hidden"),o.classList.remove("hidden")):(a.classList.remove("hidden"),o.classList.add("hidden")))}save(){if(!this.isDirty||this.isSubmitting||!this.saveForm)return;const t=this.saveForm.querySelector('input[name="description"]');t&&(t.value=this.description),this.isSubmitting=!0,this.updateUI(),this.saveForm.submit()}open(){this.modal&&(this.isOpen=!0,this.description=this.originalDescription,this.descriptionTextarea&&(this.descriptionTextarea.value=this.originalDescription),this.isDirty=!1,this.isSubmitting=!1,this.updateUI(),this.modal.classList.remove("hidden"),this.overlay?.classList.remove("hidden"),document.body.classList.add("overflow-hidden"),requestAnimationFrame(()=>{this.overlay?.classList.add("opacity-100"),this.overlay?.classList.remove("opacity-0"),this.content?.classList.add("opacity-100","translate-y-0","scale-100"),this.content?.classList.remove("opacity-0","translate-y-4","scale-95")}),this.descriptionTextarea&&setTimeout(()=>this.descriptionTextarea.focus(),100))}close(){this.modal&&(this.overlay?.classList.add("opacity-0"),this.overlay?.classList.remove("opacity-100"),this.content?.classList.add("opacity-0","translate-y-4","scale-95"),this.content?.classList.remove("opacity-100","translate-y-0","scale-100"),setTimeout(()=>{this.modal.classList.add("hidden"),this.overlay?.classList.add("hidden"),document.body.classList.remove("overflow-hidden"),this.isOpen=!1},200))}}window.ApprovalTaskDetailModalController={instances:new Map,register(i){return this.instances.has(i)||this.instances.set(i,new n(i)),this.instances.get(i)},open(i){this.register(i).open()},close(i){const t=this.instances.get(i);t&&t.close()}};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-approval-modal]").forEach(t=>{const e=t.dataset.approvalModal;e&&window.ApprovalTaskDetailModalController.register(parseInt(e))})});
