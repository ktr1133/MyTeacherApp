class r{constructor(){this.modal=null,this.backdrop=null,this.openButton=null,this.closeButton=null,this.isOpen=!1}init(){if(this.modal=document.querySelector("[data-search-modal]"),this.backdrop=this.modal?.querySelector("[data-modal-backdrop]"),this.openButton=document.querySelector("[data-open-search-modal]"),this.closeButton=this.modal?.querySelector("[data-close-modal]"),!this.modal||!this.openButton){console.warn("[SearchModal] Required elements not found");return}this.setupEventListeners()}setupEventListeners(){this.openButton.addEventListener("click",()=>this.open()),this.closeButton&&this.closeButton.addEventListener("click",()=>this.close()),this.backdrop&&this.backdrop.addEventListener("click",()=>this.close()),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen&&this.close()})}open(){if(!this.modal||this.isOpen)return;this.modal.classList.remove("hidden"),this.isOpen=!0,document.body.style.overflow="hidden";const e=this.modal.querySelector("[data-modal-content]"),o=this.modal.querySelector("[data-modal-backdrop]");e&&(e.style.transform="scale(0.95)",e.style.opacity="0"),o&&(o.style.opacity="0"),requestAnimationFrame(()=>{o&&(o.style.opacity="1"),e&&(e.style.transform="scale(1)",e.style.opacity="1")}),setTimeout(()=>{const t=this.modal.querySelector("[data-search-input]");t&&(t.focus(),t.addEventListener("keydown",this.handleSearchKeydown.bind(this)))},350),this.reinitializeTaskSearch(),console.log("[SearchModal] Opened")}handleSearchKeydown(e){e.key==="Tab"&&e.preventDefault()}reinitializeTaskSearch(){const e=this.modal.querySelector("[data-search-input]");if(!e){console.warn("[SearchModal] Search input not found in modal");return}const o=this.modal.querySelector("#search-results");o&&o.remove();const t=document.createElement("div");t.id="search-results",t.className="absolute top-full left-0 right-0 mt-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50 hidden max-h-96 overflow-y-auto";const a=e.closest(".relative");if(a&&a.appendChild(t),window.TaskSearchController){const s=new window.TaskSearchController;s.searchInput=e,s.resultsContainer=t,s.filterSelect=this.modal.querySelector("select"),s.setupEventListeners(),console.log("[SearchModal] TaskSearchController initialized for modal",{searchInput:!!s.searchInput,resultsContainer:!!s.resultsContainer,filterSelect:!!s.filterSelect})}else console.error("[SearchModal] TaskSearchController class not found")}close(){if(!this.modal||!this.isOpen)return;const e=this.modal.querySelector("[data-modal-content]"),o=this.modal.querySelector("[data-modal-backdrop]");o&&(o.style.opacity="0"),e&&(e.style.transform="scale(0.95)",e.style.opacity="0"),setTimeout(()=>{this.modal.classList.add("hidden"),this.isOpen=!1,document.body.style.overflow="";const t=this.modal.querySelector("#search-results");t&&(t.innerHTML="",t.classList.add("hidden"));const a=this.modal.querySelector("[data-search-input]");a&&(a.value=""),console.log("[SearchModal] Closed")},300)}}document.addEventListener("DOMContentLoaded",()=>{new r().init()});
